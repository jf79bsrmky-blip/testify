{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///Users/deyagharaibeh/Desktop/Runpod/lib/api-client.ts"],"sourcesContent":["import axios, { AxiosInstance, AxiosRequestConfig } from 'axios';\n\nclass ApiClient {\n  private client: AxiosInstance;\n\n  constructor() {\n    // Determine base URL - use environment variable, or detect from window location, or fallback to RunPod URL\n    let baseURL = process.env.NEXT_PUBLIC_APP_URL;\n    \n    if (!baseURL && typeof window !== 'undefined') {\n      // Use current hostname and port (works for both localhost and IP access)\n      baseURL = `${window.location.protocol}//${window.location.host}`;\n    }\n    \n    if (!baseURL) {\n      baseURL = 'https://aio83wt0ai4vge-8004.proxy.runpod.net';\n    }\n    \n    this.client = axios.create({\n      baseURL: baseURL,\n      headers: { 'Content-Type': 'application/json' },\n      timeout: 30000,\n    });\n\n    // Attach token to requests\n    this.client.interceptors.request.use(\n      (config) => {\n        const token = this.getToken();\n        if (token) {\n          config.headers.Authorization = `Bearer ${token}`;\n        }\n        return config;\n      },\n      (error) => Promise.reject(error)\n    );\n\n    // Unified error handling\n    this.client.interceptors.response.use(\n      (response) => response,\n      (error) => {\n        const status = error.response?.status;\n        const requestUrl = error.config?.url?.toString() || \"\";\n\n        // --------------------------------------------\n        // ðŸš« FIXED: Only redirect on REAL protected 401s\n        // --------------------------------------------\n        const isAuthCall =\n          requestUrl.includes('/api/auth/login') ||\n          requestUrl.includes('/api/auth/demo-credentials') ||\n          requestUrl.includes('/api/auth/refresh');\n\n        const isOnLoginPage =\n          typeof window !== 'undefined' &&\n          window.location.pathname.startsWith('/login');\n\n        if (status === 401 && !isAuthCall && !isOnLoginPage) {\n          // Unauthorized on a protected route â†’ force re-login\n          this.clearToken();\n\n          if (typeof window !== 'undefined') {\n            window.location.href = '/login';\n          }\n\n          return Promise.reject(error);\n        }\n\n        // --------------------------------------------\n        // Logging\n        // --------------------------------------------\n        if (status) {\n          if (status !== 401) {\n            console.warn('API Error:', {\n              status,\n              statusText: error.response?.statusText,\n              data: error.response?.data,\n              url: requestUrl,\n              method: error.config?.method,\n            });\n          }\n        } else if (error.request) {\n          console.error('API No Response:', {\n            url: requestUrl,\n            method: error.config?.method,\n          });\n        } else {\n          console.error('API Setup Error:', error.message);\n        }\n\n        return Promise.reject(error);\n      }\n    );\n  }\n\n  // ---------------------------\n  // Token helpers\n  // ---------------------------\n  private getToken(): string | null {\n    return typeof window !== 'undefined'\n      ? localStorage.getItem('authToken')\n      : null;\n  }\n\n  private clearToken(): void {\n    if (typeof window !== 'undefined') {\n      localStorage.removeItem('authToken');\n      localStorage.removeItem('user');\n    }\n  }\n\n  public setToken(token: string): void {\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('authToken', token);\n    }\n  }\n\n  // ---------------------------\n  // HTTP Helper Methods\n  // ---------------------------\n  async get<T>(url: string, config?: AxiosRequestConfig): Promise<T> {\n    const response = await this.client.get<T>(url, config);\n    return response.data;\n  }\n\n  async post<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {\n    const response = await this.client.post<T>(url, data, config);\n    return response.data;\n  }\n\n  async put<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {\n    const response = await this.client.put<T>(url, data, config);\n    return response.data;\n  }\n\n  async delete<T>(url: string, config?: AxiosRequestConfig): Promise<T> {\n    const response = await this.client.delete<T>(url, config);\n    return response.data;\n  }\n\n  async uploadFile<T>(\n    url: string,\n    file: File,\n    additionalData?: Record<string, any>\n  ): Promise<T> {\n    const formData = new FormData();\n    formData.append('file', file);\n\n    if (additionalData) {\n      Object.entries(additionalData).forEach(([key, value]) => {\n        formData.append(key, value);\n      });\n    }\n\n    const response = await this.client.post<T>(url, formData, {\n      headers: { 'Content-Type': 'multipart/form-data' },\n    });\n\n    return response.data;\n  }\n}\n\nexport const apiClient = new ApiClient();\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 219, "column": 0}, "map": {"version":3,"sources":["file:///Users/deyagharaibeh/Desktop/Runpod/lib/auth-context.tsx"],"sourcesContent":["'use client';\n\nimport React, {\n  createContext,\n  useContext,\n  useState,\n  useEffect,\n  ReactNode,\n} from 'react';\n\nimport { User, LoginCredentials, AuthResponse } from '@/types';\nimport { apiClient } from './api-client';\n\ninterface AuthContextType {\n  user: User | null;\n  loading: boolean;\n  login: (credentials: LoginCredentials) => Promise<AuthResponse>;\n  logout: () => Promise<void>;\n  isAuthenticated: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  // -------------------------------------------------\n  // Restore session from localStorage on first load\n  // -------------------------------------------------\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    try {\n      const storedUser = localStorage.getItem('user');\n      const storedToken = localStorage.getItem('authToken');\n\n      if (storedUser && storedToken) {\n        setUser(JSON.parse(storedUser));\n        apiClient.setToken(storedToken);\n      }\n    } catch (err) {\n      console.error('Error restoring session:', err);\n    }\n\n    setLoading(false);\n  }, []);\n\n  // -------------------------------------------------\n  // LOGIN FUNCTION â€” clean, predictable, safe\n  // -------------------------------------------------\n  const login = async (\n    credentials: LoginCredentials\n  ): Promise<AuthResponse> => {\n    try {\n      const response = await apiClient.post<AuthResponse>(\n        '/api/auth/login',\n        credentials\n      );\n\n      if (response.success && response.user && response.token) {\n        // Store user + token\n        localStorage.setItem('user', JSON.stringify(response.user));\n        localStorage.setItem('authToken', response.token);\n\n        setUser(response.user);\n        apiClient.setToken(response.token);\n\n        return response;\n      }\n\n      // Login failed (wrong password, missing fields, etc.)\n      // Do NOT clear form or redirect â€” just return failure\n      return {\n        success: false,\n        message: response.message || 'Invalid credentials.',\n        error: response.error || 'login_failed',\n      };\n    } catch (error: any) {\n      const msg =\n        error?.response?.data?.message ||\n        error?.response?.data?.error ||\n        'Login failed. Please try again.';\n\n      return {\n        success: false,\n        message: msg,\n        error: 'login_failed',\n      };\n    }\n  };\n\n  // -------------------------------------------------\n  // LOGOUT FUNCTION â€” always safe & clean\n  // -------------------------------------------------\n  const logout = async (): Promise<void> => {\n    try {\n      await apiClient.post('/api/auth/logout');\n    } catch {\n      console.warn('Logout failed (frontend cleanup will continue).');\n    }\n\n    if (typeof window !== 'undefined') {\n      localStorage.removeItem('user');\n      localStorage.removeItem('authToken');\n    }\n\n    apiClient.setToken('');\n    setUser(null);\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user,\n        loading,\n        login,\n        logout,\n        isAuthenticated: !!user,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\n// -------------------------------------------------\n// Hook for consuming auth context\n// -------------------------------------------------\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AASA;AAXA;;;;AAqBA,MAAM,4BAAc,IAAA,sNAAa,EAA8B;AAExD,SAAS,aAAa,EAAE,QAAQ,EAA2B;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAc;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,oDAAoD;IACpD,kDAAkD;IAClD,oDAAoD;IACpD,IAAA,kNAAS,EAAC;QACR,wCAAmC;;;IAerC,GAAG,EAAE;IAEL,oDAAoD;IACpD,4CAA4C;IAC5C,oDAAoD;IACpD,MAAM,QAAQ,OACZ;QAEA,IAAI;YACF,MAAM,WAAW,MAAM,iIAAS,CAAC,IAAI,CACnC,mBACA;YAGF,IAAI,SAAS,OAAO,IAAI,SAAS,IAAI,IAAI,SAAS,KAAK,EAAE;gBACvD,qBAAqB;gBACrB,aAAa,OAAO,CAAC,QAAQ,KAAK,SAAS,CAAC,SAAS,IAAI;gBACzD,aAAa,OAAO,CAAC,aAAa,SAAS,KAAK;gBAEhD,QAAQ,SAAS,IAAI;gBACrB,iIAAS,CAAC,QAAQ,CAAC,SAAS,KAAK;gBAEjC,OAAO;YACT;YAEA,sDAAsD;YACtD,sDAAsD;YACtD,OAAO;gBACL,SAAS;gBACT,SAAS,SAAS,OAAO,IAAI;gBAC7B,OAAO,SAAS,KAAK,IAAI;YAC3B;QACF,EAAE,OAAO,OAAY;YACnB,MAAM,MACJ,OAAO,UAAU,MAAM,WACvB,OAAO,UAAU,MAAM,SACvB;YAEF,OAAO;gBACL,SAAS;gBACT,SAAS;gBACT,OAAO;YACT;QACF;IACF;IAEA,oDAAoD;IACpD,wCAAwC;IACxC,oDAAoD;IACpD,MAAM,SAAS;QACb,IAAI;YACF,MAAM,iIAAS,CAAC,IAAI,CAAC;QACvB,EAAE,OAAM;YACN,QAAQ,IAAI,CAAC;QACf;QAEA;;QAKA,iIAAS,CAAC,QAAQ,CAAC;QACnB,QAAQ;IACV;IAEA,qBACE,8OAAC,YAAY,QAAQ;QACnB,OAAO;YACL;YACA;YACA;YACA;YACA,iBAAiB,CAAC,CAAC;QACrB;kBAEC;;;;;;AAGP;AAKO,SAAS;IACd,MAAM,UAAU,IAAA,mNAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT","debugId":null}}]
}