{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/deyagharaibeh/Desktop/Runpod/components/heygen/StreamingAvatarProvider.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useRef, useState } from \"react\";\r\nimport StreamingAvatar, {\r\n  ConnectionQuality,\r\n  StreamingTalkingMessageEvent,\r\n  UserTalkingMessageEvent,\r\n} from \"@heygen/streaming-avatar\";\r\n\r\n// Knowledge base ID for YTL LLM (uploaded KBs, not HeyGen KBs)\r\nlet globalKnowledgeBaseId: string | undefined = undefined;\r\n\r\nexport const setKnowledgeBaseId = (id: string | undefined) => {\r\n  globalKnowledgeBaseId = id;\r\n  console.log('üìö Global knowledge base ID set for YTL LLM:', id || 'none');\r\n};\r\n\r\nexport const getKnowledgeBaseId = (): string | undefined => {\r\n  return globalKnowledgeBaseId;\r\n};\r\n\r\nexport enum StreamingAvatarSessionState {\r\n  INACTIVE = \"inactive\",\r\n  CONNECTING = \"connecting\",\r\n  CONNECTED = \"connected\",\r\n}\r\n\r\nexport enum MessageSender {\r\n  CLIENT = \"CLIENT\",\r\n  AVATAR = \"AVATAR\",\r\n}\r\n\r\nexport interface Message {\r\n  id: string;\r\n  sender: MessageSender;\r\n  content: string;\r\n  timestamp?: number; // Session time in seconds when message was created\r\n}\r\n\r\ntype StreamingAvatarContextProps = {\r\n  avatarRef: React.MutableRefObject<StreamingAvatar | null>;\r\n  basePath?: string;\r\n  isMuted: boolean;\r\n  setIsMuted: (value: boolean) => void;\r\n  isVoiceChatLoading: boolean;\r\n  setIsVoiceChatLoading: (value: boolean) => void;\r\n  isVoiceChatActive: boolean;\r\n  setIsVoiceChatActive: (value: boolean) => void;\r\n  sessionState: StreamingAvatarSessionState;\r\n  setSessionState: (state: StreamingAvatarSessionState) => void;\r\n  stream: MediaStream | null;\r\n  setStream: (stream: MediaStream | null) => void;\r\n  messages: Message[];\r\n  clearMessages: () => void;\r\n  handleUserTalkingMessage: ({\r\n    detail,\r\n  }: {\r\n    detail: UserTalkingMessageEvent;\r\n  }) => void;\r\n  handleStreamingTalkingMessage: ({\r\n    detail,\r\n  }: {\r\n    detail: StreamingTalkingMessageEvent;\r\n  }) => void;\r\n  handleEndMessage: () => void;\r\n  isListening: boolean;\r\n  setIsListening: (value: boolean) => void;\r\n  isUserTalking: boolean;\r\n  setIsUserTalking: (value: boolean) => void;\r\n  isAvatarTalking: boolean;\r\n  setIsAvatarTalking: (value: boolean) => void;\r\n  connectionQuality: ConnectionQuality;\r\n  setConnectionQuality: (value: ConnectionQuality) => void;\r\n};\r\n\r\nconst StreamingAvatarContext = React.createContext<StreamingAvatarContextProps>(\r\n  {\r\n    avatarRef: { current: null },\r\n    basePath: undefined,\r\n    isMuted: false, // Default to unmuted (mic open)\r\n    setIsMuted: () => {},\r\n    isVoiceChatLoading: false,\r\n    setIsVoiceChatLoading: () => {},\r\n    isVoiceChatActive: false,\r\n    setIsVoiceChatActive: () => {},\r\n    sessionState: StreamingAvatarSessionState.INACTIVE,\r\n    setSessionState: () => {},\r\n    stream: null,\r\n    setStream: () => {},\r\n    messages: [],\r\n    clearMessages: () => {},\r\n    handleUserTalkingMessage: () => {},\r\n    handleStreamingTalkingMessage: () => {},\r\n    handleEndMessage: () => {},\r\n    isListening: false,\r\n    setIsListening: () => {},\r\n    isUserTalking: false,\r\n    setIsUserTalking: () => {},\r\n    isAvatarTalking: false,\r\n    setIsAvatarTalking: () => {},\r\n    connectionQuality: ConnectionQuality.UNKNOWN,\r\n    setConnectionQuality: () => {},\r\n  },\r\n);\r\n\r\nconst useStreamingAvatarSessionState = () => {\r\n  const [sessionState, setSessionState] = useState(\r\n    StreamingAvatarSessionState.INACTIVE,\r\n  );\r\n  const [stream, setStream] = useState<MediaStream | null>(null);\r\n\r\n  return {\r\n    sessionState,\r\n    setSessionState,\r\n    stream,\r\n    setStream,\r\n  };\r\n};\r\n\r\nconst useStreamingAvatarVoiceChatState = () => {\r\n  const [isMuted, setIsMuted] = useState(false); // Default to unmuted (mic open)\r\n  const [isVoiceChatLoading, setIsVoiceChatLoading] = useState(false);\r\n  const [isVoiceChatActive, setIsVoiceChatActive] = useState(false);\r\n\r\n  return {\r\n    isMuted,\r\n    setIsMuted,\r\n    isVoiceChatLoading,\r\n    setIsVoiceChatLoading,\r\n    isVoiceChatActive,\r\n    setIsVoiceChatActive,\r\n  };\r\n};\r\n\r\nconst useStreamingAvatarMessageState = () => {\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const currentSenderRef = useRef<MessageSender | null>(null);\r\n\r\n  const handleUserTalkingMessage = React.useCallback(\r\n    ({\r\n      detail,\r\n    }: {\r\n      detail: UserTalkingMessageEvent;\r\n    }) => {\r\n      if (currentSenderRef.current === MessageSender.CLIENT) {\r\n        setMessages((prev) => [\r\n          ...prev.slice(0, -1),\r\n          {\r\n            ...prev[prev.length - 1],\r\n            content: [prev[prev.length - 1].content, detail.message].join(\"\"),\r\n          },\r\n        ]);\r\n      } else {\r\n        currentSenderRef.current = MessageSender.CLIENT;\r\n        setMessages((prev) => [\r\n          ...prev,\r\n          {\r\n            id: Date.now().toString(),\r\n            sender: MessageSender.CLIENT,\r\n            content: detail.message,\r\n          },\r\n        ]);\r\n      }\r\n    },\r\n    [],\r\n  );\r\n\r\n  const handleStreamingTalkingMessage = React.useCallback(\r\n    ({\r\n      detail,\r\n    }: {\r\n      detail: StreamingTalkingMessageEvent;\r\n    }) => {\r\n      if (currentSenderRef.current === MessageSender.AVATAR) {\r\n        setMessages((prev) => [\r\n          ...prev.slice(0, -1),\r\n          {\r\n            ...prev[prev.length - 1],\r\n            content: [prev[prev.length - 1].content, detail.message].join(\"\"),\r\n          },\r\n        ]);\r\n      } else {\r\n        currentSenderRef.current = MessageSender.AVATAR;\r\n        setMessages((prev) => [\r\n          ...prev,\r\n          {\r\n            id: Date.now().toString(),\r\n            sender: MessageSender.AVATAR,\r\n            content: detail.message,\r\n          },\r\n        ]);\r\n      }\r\n    },\r\n    [],\r\n  );\r\n\r\n  const handleEndMessage = React.useCallback(() => {\r\n    currentSenderRef.current = null;\r\n  }, []);\r\n\r\n  return {\r\n    messages,\r\n    clearMessages: React.useCallback(() => {\r\n      setMessages([]);\r\n      currentSenderRef.current = null;\r\n    }, []),\r\n    handleUserTalkingMessage,\r\n    handleStreamingTalkingMessage,\r\n    handleEndMessage,\r\n  };\r\n};\r\n\r\nconst useStreamingAvatarListeningState = () => {\r\n  const [isListening, setIsListening] = useState(false);\r\n\r\n  return { isListening, setIsListening };\r\n};\r\n\r\nconst useStreamingAvatarTalkingState = () => {\r\n  const [isUserTalking, setIsUserTalking] = useState(false);\r\n  const [isAvatarTalking, setIsAvatarTalking] = useState(false);\r\n\r\n  return {\r\n    isUserTalking,\r\n    setIsUserTalking,\r\n    isAvatarTalking,\r\n    setIsAvatarTalking,\r\n  };\r\n};\r\n\r\nconst useStreamingAvatarConnectionQualityState = () => {\r\n  const [connectionQuality, setConnectionQuality] = useState(\r\n    ConnectionQuality.UNKNOWN,\r\n  );\r\n\r\n  return { connectionQuality, setConnectionQuality };\r\n};\r\n\r\nexport const StreamingAvatarProvider = ({\r\n  children,\r\n  basePath,\r\n}: {\r\n  children: React.ReactNode;\r\n  basePath?: string;\r\n}) => {\r\n  const avatarRef = React.useRef<StreamingAvatar>(null);\r\n  const voiceChatState = useStreamingAvatarVoiceChatState();\r\n  const sessionState = useStreamingAvatarSessionState();\r\n  const messageState = useStreamingAvatarMessageState();\r\n  const listeningState = useStreamingAvatarListeningState();\r\n  const talkingState = useStreamingAvatarTalkingState();\r\n  const connectionQualityState = useStreamingAvatarConnectionQualityState();\r\n\r\n  React.useEffect(() => {\r\n    console.log('üé≠ StreamingAvatarProvider initialized with basePath:', basePath || 'default (https://api.heygen.com)');\r\n  }, [basePath]);\r\n\r\n  return (\r\n    <StreamingAvatarContext.Provider\r\n      value={{\r\n        avatarRef,\r\n        basePath,\r\n        ...voiceChatState,\r\n        ...sessionState,\r\n        ...messageState,\r\n        ...listeningState,\r\n        ...talkingState,\r\n        ...connectionQualityState,\r\n      }}\r\n    >\r\n      {children}\r\n    </StreamingAvatarContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useStreamingAvatarContext = () =>\r\n  React.useContext(StreamingAvatarContext);\r\n\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 274, "column": 0}, "map": {"version":3,"sources":["file:///Users/deyagharaibeh/Desktop/Runpod/components/heygen/hooks/useVoiceChat.ts"],"sourcesContent":["\"use client\";\r\n\r\nimport { useCallback } from \"react\";\r\n\r\nimport { useStreamingAvatarContext } from \"../StreamingAvatarProvider\";\r\n\r\nexport const useVoiceChat = () => {\r\n  const {\r\n    avatarRef,\r\n    isMuted,\r\n    setIsMuted,\r\n    isVoiceChatActive,\r\n    setIsVoiceChatActive,\r\n    isVoiceChatLoading,\r\n    setIsVoiceChatLoading,\r\n  } = useStreamingAvatarContext();\r\n\r\n  const startVoiceChat = useCallback(\r\n    async (isInputAudioMuted: boolean = false) => {\r\n      if (!avatarRef.current) {\r\n        console.warn('‚ö†Ô∏è Cannot start voice chat: avatar not initialized');\r\n        return;\r\n      }\r\n      \r\n      console.log('üé§ Starting voice chat with mute state:', isInputAudioMuted);\r\n      console.log('üìä Avatar ref status:', {\r\n        hasAvatarRef: !!avatarRef.current,\r\n        avatarType: avatarRef.current?.constructor?.name,\r\n      });\r\n      setIsVoiceChatLoading(true);\r\n      \r\n      try {\r\n        // Start voice chat with HeyGen SDK (it will handle microphone permissions)\r\n        console.log('üìû Calling avatarRef.current.startVoiceChat with options:', {\r\n          isInputAudioMuted,\r\n        });\r\n        \r\n        const result = await avatarRef.current?.startVoiceChat({\r\n          isInputAudioMuted,\r\n        });\r\n        \r\n        console.log('üìû startVoiceChat returned:', result);\r\n        \r\n        setIsVoiceChatLoading(false);\r\n        setIsVoiceChatActive(true);\r\n        setIsMuted(isInputAudioMuted);\r\n        console.log('‚úÖ Voice chat started successfully, microphone is', isInputAudioMuted ? 'MUTED' : 'UNMUTED');\r\n      } catch (error) {\r\n        console.error('‚ùå Failed to start voice chat:', error);\r\n        console.error('Error details:', {\r\n          message: error instanceof Error ? error.message : String(error),\r\n          stack: error instanceof Error ? error.stack : undefined,\r\n          name: error instanceof Error ? error.name : undefined,\r\n          error: error,\r\n        });\r\n        \r\n        // Provide user-friendly error message\r\n        let userMessage = 'Failed to start microphone. ';\r\n        if (error instanceof Error) {\r\n          if (error.message.includes('permission') || error.message.includes('Permission')) {\r\n            userMessage += 'Please allow microphone access in your browser settings and try again.';\r\n          } else if (error.message.includes('NotAllowedError') || error.name === 'NotAllowedError') {\r\n            userMessage += 'Microphone permission was denied. Please allow access and try again.';\r\n          } else if (error.message.includes('NotFoundError') || error.name === 'NotFoundError') {\r\n            userMessage += 'No microphone found. Please connect a microphone and try again.';\r\n          } else {\r\n            userMessage += error.message;\r\n          }\r\n        } else {\r\n          userMessage += 'Please check your browser console for details.';\r\n        }\r\n        \r\n        setIsVoiceChatLoading(false);\r\n        setIsVoiceChatActive(false);\r\n        \r\n        // Create a new error with user-friendly message\r\n        const userError = new Error(userMessage);\r\n        throw userError;\r\n      }\r\n    },\r\n    [avatarRef, setIsMuted, setIsVoiceChatActive, setIsVoiceChatLoading],\r\n  );\r\n\r\n  const stopVoiceChat = useCallback(() => {\r\n    if (!avatarRef.current) return;\r\n    avatarRef.current?.closeVoiceChat();\r\n    setIsVoiceChatActive(false);\r\n    setIsMuted(true);\r\n  }, [avatarRef, setIsMuted, setIsVoiceChatActive]);\r\n\r\n  const muteInputAudio = useCallback(() => {\r\n    if (!avatarRef.current) {\r\n      console.warn('‚ö†Ô∏è Cannot mute: avatar not initialized');\r\n      return;\r\n    }\r\n    console.log('üîá Muting microphone...');\r\n    avatarRef.current?.muteInputAudio();\r\n    setIsMuted(true);\r\n    console.log('‚úÖ Microphone muted');\r\n  }, [avatarRef, setIsMuted]);\r\n\r\n  const unmuteInputAudio = useCallback(() => {\r\n    if (!avatarRef.current) {\r\n      console.warn('‚ö†Ô∏è Cannot unmute: avatar not initialized');\r\n      return;\r\n    }\r\n    console.log('üîä Unmuting microphone...');\r\n    avatarRef.current?.unmuteInputAudio();\r\n    setIsMuted(false);\r\n    console.log('‚úÖ Microphone unmuted');\r\n  }, [avatarRef, setIsMuted]);\r\n\r\n  return {\r\n    startVoiceChat,\r\n    stopVoiceChat,\r\n    muteInputAudio,\r\n    unmuteInputAudio,\r\n    isMuted,\r\n    isVoiceChatActive,\r\n    isVoiceChatLoading,\r\n  };\r\n};\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAEA;AAEA;;AAJA;;;AAMO,MAAM,eAAe;;IAC1B,MAAM,EACJ,SAAS,EACT,OAAO,EACP,UAAU,EACV,iBAAiB,EACjB,oBAAoB,EACpB,kBAAkB,EAClB,qBAAqB,EACtB,GAAG,IAAA,gLAAyB;IAE7B,MAAM,iBAAiB,IAAA,4KAAW;oDAChC,OAAO,oBAA6B,KAAK;YACvC,IAAI,CAAC,UAAU,OAAO,EAAE;gBACtB,QAAQ,IAAI,CAAC;gBACb;YACF;YAEA,QAAQ,GAAG,CAAC,2CAA2C;YACvD,QAAQ,GAAG,CAAC,yBAAyB;gBACnC,cAAc,CAAC,CAAC,UAAU,OAAO;gBACjC,YAAY,UAAU,OAAO,EAAE,aAAa;YAC9C;YACA,sBAAsB;YAEtB,IAAI;gBACF,2EAA2E;gBAC3E,QAAQ,GAAG,CAAC,6DAA6D;oBACvE;gBACF;gBAEA,MAAM,SAAS,MAAM,UAAU,OAAO,EAAE,eAAe;oBACrD;gBACF;gBAEA,QAAQ,GAAG,CAAC,+BAA+B;gBAE3C,sBAAsB;gBACtB,qBAAqB;gBACrB,WAAW;gBACX,QAAQ,GAAG,CAAC,oDAAoD,oBAAoB,UAAU;YAChG,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,iCAAiC;gBAC/C,QAAQ,KAAK,CAAC,kBAAkB;oBAC9B,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;oBACzD,OAAO,iBAAiB,QAAQ,MAAM,KAAK,GAAG;oBAC9C,MAAM,iBAAiB,QAAQ,MAAM,IAAI,GAAG;oBAC5C,OAAO;gBACT;gBAEA,sCAAsC;gBACtC,IAAI,cAAc;gBAClB,IAAI,iBAAiB,OAAO;oBAC1B,IAAI,MAAM,OAAO,CAAC,QAAQ,CAAC,iBAAiB,MAAM,OAAO,CAAC,QAAQ,CAAC,eAAe;wBAChF,eAAe;oBACjB,OAAO,IAAI,MAAM,OAAO,CAAC,QAAQ,CAAC,sBAAsB,MAAM,IAAI,KAAK,mBAAmB;wBACxF,eAAe;oBACjB,OAAO,IAAI,MAAM,OAAO,CAAC,QAAQ,CAAC,oBAAoB,MAAM,IAAI,KAAK,iBAAiB;wBACpF,eAAe;oBACjB,OAAO;wBACL,eAAe,MAAM,OAAO;oBAC9B;gBACF,OAAO;oBACL,eAAe;gBACjB;gBAEA,sBAAsB;gBACtB,qBAAqB;gBAErB,gDAAgD;gBAChD,MAAM,YAAY,IAAI,MAAM;gBAC5B,MAAM;YACR;QACF;mDACA;QAAC;QAAW;QAAY;QAAsB;KAAsB;IAGtE,MAAM,gBAAgB,IAAA,4KAAW;mDAAC;YAChC,IAAI,CAAC,UAAU,OAAO,EAAE;YACxB,UAAU,OAAO,EAAE;YACnB,qBAAqB;YACrB,WAAW;QACb;kDAAG;QAAC;QAAW;QAAY;KAAqB;IAEhD,MAAM,iBAAiB,IAAA,4KAAW;oDAAC;YACjC,IAAI,CAAC,UAAU,OAAO,EAAE;gBACtB,QAAQ,IAAI,CAAC;gBACb;YACF;YACA,QAAQ,GAAG,CAAC;YACZ,UAAU,OAAO,EAAE;YACnB,WAAW;YACX,QAAQ,GAAG,CAAC;QACd;mDAAG;QAAC;QAAW;KAAW;IAE1B,MAAM,mBAAmB,IAAA,4KAAW;sDAAC;YACnC,IAAI,CAAC,UAAU,OAAO,EAAE;gBACtB,QAAQ,IAAI,CAAC;gBACb;YACF;YACA,QAAQ,GAAG,CAAC;YACZ,UAAU,OAAO,EAAE;YACnB,WAAW;YACX,QAAQ,GAAG,CAAC;QACd;qDAAG;QAAC;QAAW;KAAW;IAE1B,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF;GAnHa;;QASP,gLAAyB","debugId":null}},
    {"offset": {"line": 412, "column": 0}, "map": {"version":3,"sources":["file:///Users/deyagharaibeh/Desktop/Runpod/components/heygen/hooks/useMessageHistory.ts"],"sourcesContent":["\"use client\";\r\n\r\nimport { useStreamingAvatarContext } from \"../StreamingAvatarProvider\";\r\n\r\nexport const useMessageHistory = () => {\r\n  const { messages } = useStreamingAvatarContext();\r\n\r\n  return { messages };\r\n};\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAEA;;AAFA;;AAIO,MAAM,oBAAoB;;IAC/B,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,gLAAyB;IAE9C,OAAO;QAAE;IAAS;AACpB;GAJa;;QACU,gLAAyB","debugId":null}},
    {"offset": {"line": 439, "column": 0}, "map": {"version":3,"sources":["file:///Users/deyagharaibeh/Desktop/Runpod/components/heygen/hooks/useStreamingAvatarSession.ts"],"sourcesContent":["\"use client\";\r\n\r\nimport { useCallback, useRef } from \"react\";\r\nimport StreamingAvatar, {\r\n  ConnectionQuality,\r\n  StartAvatarRequest,\r\n  StreamingEvents,\r\n} from \"@heygen/streaming-avatar\";\r\n\r\nimport {\r\n  StreamingAvatarSessionState,\r\n  useStreamingAvatarContext,\r\n} from \"../StreamingAvatarProvider\";\r\nimport { useVoiceChat } from \"./useVoiceChat\";\r\nimport { useMessageHistory } from \"./useMessageHistory\";\r\n\r\nexport const useStreamingAvatarSession = () => {\r\n  const {\r\n    avatarRef,\r\n    basePath,\r\n    sessionState,\r\n    setSessionState,\r\n    stream,\r\n    setStream,\r\n    setIsListening,\r\n    setIsUserTalking,\r\n    setIsAvatarTalking,\r\n    setConnectionQuality,\r\n    handleUserTalkingMessage,\r\n    handleStreamingTalkingMessage,\r\n    handleEndMessage,\r\n    clearMessages,\r\n  } = useStreamingAvatarContext();\r\n  const { stopVoiceChat } = useVoiceChat();\r\n\r\n  useMessageHistory();\r\n\r\n  const init = useCallback(\r\n    (token: string) => {\r\n      console.log('üîß Initializing StreamingAvatar with:', {\r\n        tokenLength: token.length,\r\n        tokenPreview: token.substring(0, 20) + '...',\r\n        basePath: basePath || 'default',\r\n      });\r\n      avatarRef.current = new StreamingAvatar({\r\n        token,\r\n        basePath,\r\n      });\r\n      console.log('‚úÖ StreamingAvatar initialized');\r\n      return avatarRef.current;\r\n    },\r\n    [avatarRef, basePath],\r\n  );\r\n\r\n  const handleStream = useCallback(\r\n    ({ detail }: { detail: MediaStream }) => {\r\n      console.log('üé• STREAM_READY event received!', {\r\n        hasStream: !!detail,\r\n        streamId: detail?.id,\r\n        tracks: detail?.getTracks().length,\r\n      });\r\n      setStream(detail);\r\n      setSessionState(StreamingAvatarSessionState.CONNECTED);\r\n      console.log('‚úÖ Session state set to CONNECTED');\r\n    },\r\n    [setSessionState, setStream],\r\n  );\r\n\r\n  // Track connection state to handle disconnections properly\r\n  const hasConnectedRef = useRef(false);\r\n  \r\n  const stop = useCallback(async () => {\r\n    hasConnectedRef.current = false;\r\n    avatarRef.current?.off(StreamingEvents.STREAM_READY, handleStream);\r\n    clearMessages();\r\n    stopVoiceChat();\r\n    setIsListening(false);\r\n    setIsUserTalking(false);\r\n    setIsAvatarTalking(false);\r\n    setStream(null);\r\n    await avatarRef.current?.stopAvatar();\r\n    setSessionState(StreamingAvatarSessionState.INACTIVE);\r\n  }, [\r\n    avatarRef,\r\n    clearMessages,\r\n    handleStream,\r\n    setIsAvatarTalking,\r\n    setIsListening,\r\n    setIsUserTalking,\r\n    setSessionState,\r\n    setStream,\r\n    stopVoiceChat,\r\n  ]);\r\n  \r\n  const handleDisconnected = useCallback((event: any) => {\r\n    console.warn('‚ö†Ô∏è STREAM_DISCONNECTED event received:', {\r\n      event,\r\n      hasConnected: hasConnectedRef.current,\r\n      currentState: sessionState,\r\n      hasStream: !!stream,\r\n    });\r\n    \r\n    // Remove the disconnected listener to prevent multiple calls\r\n    avatarRef.current?.off(StreamingEvents.STREAM_DISCONNECTED, handleDisconnected);\r\n    \r\n    // Only stop if we were actually connected\r\n    // If we disconnect before connecting, it might be a configuration or token issue\r\n    if (hasConnectedRef.current) {\r\n      console.log('üõë Stream was connected, stopping session...');\r\n      stop();\r\n    } else {\r\n      console.error('‚ùå Stream disconnected before connection was established. This might indicate:');\r\n      console.error('   - Invalid or expired token');\r\n      console.error('   - Configuration error');\r\n      console.error('   - Network connectivity issue');\r\n      console.error('   - Avatar name or settings mismatch');\r\n      \r\n      // Set state to inactive and clear stream without calling full stop\r\n      hasConnectedRef.current = false;\r\n      setSessionState(StreamingAvatarSessionState.INACTIVE);\r\n      setStream(null);\r\n      setIsListening(false);\r\n      setIsUserTalking(false);\r\n      setIsAvatarTalking(false);\r\n    }\r\n  }, [sessionState, stream, stop, setSessionState, setStream, setIsListening, setIsUserTalking, setIsAvatarTalking, avatarRef]);\r\n\r\n  const start = useCallback(\r\n    async (config: StartAvatarRequest, token?: string) => {\r\n      console.log('üöÄ Starting avatar session...', {\r\n        currentState: sessionState,\r\n        hasAvatarRef: !!avatarRef.current,\r\n        hasToken: !!token,\r\n        config: {\r\n          avatarName: config.avatarName,\r\n          quality: config.quality,\r\n          language: config.language,\r\n          knowledgeId: config.knowledgeId,\r\n        },\r\n      });\r\n\r\n      if (sessionState !== StreamingAvatarSessionState.INACTIVE) {\r\n        const errorMsg = `Cannot start avatar: session state is ${sessionState}, expected INACTIVE`;\r\n        console.error('‚ùå', errorMsg);\r\n        throw new Error(errorMsg);\r\n      }\r\n\r\n      // Clean up any existing avatar instance first\r\n      if (avatarRef.current) {\r\n        console.log('üßπ Cleaning up existing avatar instance...');\r\n        try {\r\n          await avatarRef.current.stopAvatar().catch(() => {\r\n            // Ignore errors during cleanup\r\n          });\r\n        } catch (e) {\r\n          // Ignore cleanup errors\r\n        }\r\n        avatarRef.current = null;\r\n      }\r\n\r\n      if (!token) {\r\n        throw new Error(\"Token is required to initialize avatar\");\r\n      }\r\n      \r\n      console.log('üîß Initializing new avatar instance...');\r\n      init(token);\r\n\r\n      if (!avatarRef.current) {\r\n        throw new Error(\"Avatar is not initialized\");\r\n      }\r\n\r\n      const avatar: StreamingAvatar = avatarRef.current;\r\n      console.log('üì° Setting up event listeners...');\r\n      // Reset connection tracking\r\n      hasConnectedRef.current = false;\r\n      \r\n      // Remove any existing listeners first to avoid duplicates\r\n      avatar.off(StreamingEvents.STREAM_READY, handleStream);\r\n      avatar.off(StreamingEvents.STREAM_DISCONNECTED, handleDisconnected);\r\n      \r\n      setSessionState(StreamingAvatarSessionState.CONNECTING);\r\n      \r\n      // Wrap handleStream to track connection\r\n      const handleStreamWithTracking = (event: { detail: MediaStream }) => {\r\n        hasConnectedRef.current = true;\r\n        console.log('‚úÖ Stream connected successfully');\r\n        handleStream(event);\r\n      };\r\n      \r\n      avatar.on(StreamingEvents.STREAM_READY, handleStreamWithTracking);\r\n      avatar.on(StreamingEvents.STREAM_DISCONNECTED, handleDisconnected);\r\n      avatar.on(\r\n        StreamingEvents.CONNECTION_QUALITY_CHANGED,\r\n        ({ detail }: { detail: ConnectionQuality }) =>\r\n          setConnectionQuality(detail),\r\n      );\r\n      avatar.on(StreamingEvents.USER_START, () => {\r\n        setIsUserTalking(true);\r\n      });\r\n      avatar.on(StreamingEvents.USER_STOP, () => {\r\n        setIsUserTalking(false);\r\n      });\r\n      avatar.on(StreamingEvents.AVATAR_START_TALKING, () => {\r\n        setIsAvatarTalking(true);\r\n      });\r\n      avatar.on(StreamingEvents.AVATAR_STOP_TALKING, () => {\r\n        setIsAvatarTalking(false);\r\n      });\r\n      avatar.on(\r\n        StreamingEvents.USER_TALKING_MESSAGE,\r\n        handleUserTalkingMessage,\r\n      );\r\n      avatar.on(\r\n        StreamingEvents.AVATAR_TALKING_MESSAGE,\r\n        handleStreamingTalkingMessage,\r\n      );\r\n      avatar.on(StreamingEvents.USER_END_MESSAGE, handleEndMessage);\r\n      avatar.on(\r\n        StreamingEvents.AVATAR_END_MESSAGE,\r\n        handleEndMessage,\r\n      );\r\n\r\n      console.log('üé¨ Calling createStartAvatar...');\r\n      try {\r\n        await avatar.createStartAvatar(config);\r\n        console.log('‚úÖ createStartAvatar completed successfully');\r\n      } catch (error) {\r\n        console.error('‚ùå createStartAvatar failed:', error);\r\n        throw error;\r\n      }\r\n\r\n      return avatarRef.current;\r\n    },\r\n    [\r\n      avatarRef,\r\n      handleDisconnected,\r\n      handleEndMessage,\r\n      handleStream,\r\n      handleStreamingTalkingMessage,\r\n      handleUserTalkingMessage,\r\n      init,\r\n      sessionState,\r\n      setConnectionQuality,\r\n      setIsAvatarTalking,\r\n      setIsUserTalking,\r\n      setSessionState,\r\n      stop,\r\n    ],\r\n  );\r\n\r\n  return {\r\n    avatarRef,\r\n    sessionState,\r\n    stream,\r\n    initAvatar: init,\r\n    startAvatar: start,\r\n    stopAvatar: stop,\r\n  };\r\n};\r\n\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 693, "column": 0}, "map": {"version":3,"sources":["file:///Users/deyagharaibeh/Desktop/Runpod/components/heygen/AvatarVideo.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React from \"react\";\r\n\r\nexport const AvatarVideo = React.forwardRef<HTMLVideoElement>((_, ref) => {\r\n  return (\r\n    <video\r\n      ref={ref}\r\n      autoPlay\r\n      playsInline\r\n      className=\"w-full h-full object-contain\"\r\n    />\r\n  );\r\n});\r\n\r\nAvatarVideo.displayName = \"AvatarVideo\";\r\n\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAIO,MAAM,4BAAc,wKAAK,CAAC,UAAU,MAAmB,CAAC,GAAG;IAChE,qBACE,6LAAC;QACC,KAAK;QACL,QAAQ;QACR,WAAW;QACX,WAAU;;;;;;AAGhB;;AAEA,YAAY,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 726, "column": 0}, "map": {"version":3,"sources":["file:///Users/deyagharaibeh/Desktop/Runpod/components/heygen/MessageHistory.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef } from \"react\";\r\n\r\nimport {\r\n  MessageSender,\r\n  useStreamingAvatarContext,\r\n} from \"./StreamingAvatarProvider\";\r\n\r\n// Helper function to format timestamp (in seconds) to MM:SS format\r\nconst formatTimestamp = (seconds: number): string => {\r\n  const minutes = Math.floor(seconds / 60);\r\n  const secs = Math.floor(seconds % 60);\r\n  return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;\r\n};\r\n\r\ninterface MessageHistoryProps {\r\n  sessionTime: number;\r\n  // Optional mapping from message ID to the session time (in seconds)\r\n  // when the message was first received\r\n  messageTimes?: Record<string, number>;\r\n}\r\n\r\nexport const MessageHistory = ({ sessionTime, messageTimes }: MessageHistoryProps) => {\r\n  const { messages } = useStreamingAvatarContext();\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    if (!containerRef.current) return;\r\n    containerRef.current.scrollTop = containerRef.current.scrollHeight;\r\n  }, [messages]);\r\n\r\n  return (\r\n    <div\r\n      ref={containerRef}\r\n      className=\"w-full flex flex-col gap-4 p-4\"\r\n    >\r\n      {messages.length === 0 ? (\r\n        <div className=\"text-center text-gray-400 text-sm py-8 px-4\">\r\n          Waiting for conversation to start...\r\n        </div>\r\n      ) : (\r\n        messages.map((message) => {\r\n          // Prefer explicit session-time-per-message if provided,\r\n          // then message.timestamp (if set), otherwise fall back to current session time\r\n          const messageTime =\r\n            (messageTimes && messageTimes[message.id]) ??\r\n            (message.timestamp ?? sessionTime);\r\n          const timestamp = formatTimestamp(messageTime);\r\n          \r\n          return (\r\n            <div\r\n              key={message.id}\r\n              className={`flex flex-col ${\r\n                message.sender === MessageSender.CLIENT ? \"items-end\" : \"items-start\"\r\n              }`}\r\n            >\r\n              <div\r\n                className={`rounded-lg px-4 py-3 max-w-[85%] ${\r\n                  message.sender === MessageSender.CLIENT\r\n                    ? \"bg-gray-700 text-white\"\r\n                    : \"bg-gray-100 text-gray-900\"\r\n                }`}\r\n              >\r\n                <p className=\"text-sm leading-relaxed break-words\">{message.content}</p>\r\n              </div>\r\n              <span className=\"text-xs text-gray-500 mt-1 px-1\">\r\n                {timestamp}\r\n              </span>\r\n            </div>\r\n          );\r\n        })\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;AAEA;;;AAJA;;;AASA,mEAAmE;AACnE,MAAM,kBAAkB,CAAC;IACvB,MAAM,UAAU,KAAK,KAAK,CAAC,UAAU;IACrC,MAAM,OAAO,KAAK,KAAK,CAAC,UAAU;IAClC,OAAO,GAAG,OAAO,SAAS,QAAQ,CAAC,GAAG,KAAK,CAAC,EAAE,OAAO,MAAM,QAAQ,CAAC,GAAG,MAAM;AAC/E;AASO,MAAM,iBAAiB,CAAC,EAAE,WAAW,EAAE,YAAY,EAAuB;;IAC/E,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,gLAAyB;IAC9C,MAAM,eAAe,IAAA,uKAAM,EAAiB;IAE5C,IAAA,0KAAS;oCAAC;YACR,IAAI,CAAC,aAAa,OAAO,EAAE;YAC3B,aAAa,OAAO,CAAC,SAAS,GAAG,aAAa,OAAO,CAAC,YAAY;QACpE;mCAAG;QAAC;KAAS;IAEb,qBACE,6LAAC;QACC,KAAK;QACL,WAAU;kBAET,SAAS,MAAM,KAAK,kBACnB,6LAAC;YAAI,WAAU;sBAA8C;;;;;uDAI7D,SAAS,GAAG,CAAC,CAAC;YACZ,wDAAwD;YACxD,+EAA+E;YAC/E,MAAM,cACJ,CAAC,gBAAgB,YAAY,CAAC,QAAQ,EAAE,CAAC,KACxC,QAAQ,SAAS,IAAI;YACxB,MAAM,YAAY,gBAAgB;YAElC,qBACE,6LAAC;gBAEC,WAAW,CAAC,cAAc,EACxB,QAAQ,MAAM,KAAK,oKAAa,CAAC,MAAM,GAAG,cAAc,eACxD;;kCAEF,6LAAC;wBACC,WAAW,CAAC,iCAAiC,EAC3C,QAAQ,MAAM,KAAK,oKAAa,CAAC,MAAM,GACnC,2BACA,6BACJ;kCAEF,cAAA,6LAAC;4BAAE,WAAU;sCAAuC,QAAQ,OAAO;;;;;;;;;;;kCAErE,6LAAC;wBAAK,WAAU;kCACb;;;;;;;eAfE,QAAQ,EAAE;;;;;QAmBrB;;;;;;AAIR;GApDa;;QACU,gLAAyB;;;KADnC","debugId":null}},
    {"offset": {"line": 825, "column": 0}, "map": {"version":3,"sources":["file:///Users/deyagharaibeh/Desktop/Runpod/components/heygen/MicrophoneButtonControl.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useVoiceChat } from '@/components/heygen/hooks/useVoiceChat';\r\nimport { useState, useEffect } from 'react';\r\n\r\nexport const MicrophoneButtonControl = () => {\r\n  const { startVoiceChat, stopVoiceChat, isVoiceChatActive } = useVoiceChat();\r\n  const [isMobile, setIsMobile] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const mobile =\r\n      typeof window !== 'undefined' &&\r\n      /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);\r\n\r\n    setIsMobile(mobile);\r\n  }, []);\r\n\r\n  const requestMicPermission = async () => {\r\n    try {\r\n      console.log(\"üé§ Requesting microphone permission...\");\r\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n\r\n      // Stop immediately ‚Üí we only needed permission\r\n      stream.getTracks().forEach((t) => t.stop());\r\n\r\n      console.log(\"‚úÖ Microphone permission granted\");\r\n      return true;\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Microphone permission denied:\", err);\r\n      setError(\"Microphone access denied. Please enable mic in browser settings.\");\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const toggleMic = async () => {\r\n    try {\r\n      if (!isVoiceChatActive) {\r\n        console.log(\"üé§ User tapped ‚Üí Start requested\");\r\n\r\n        // -------------------------------\r\n        // üî• MOBILE FIX: Ask permission first\r\n        // -------------------------------\r\n        if (isMobile) {\r\n          const allowed = await requestMicPermission();\r\n          if (!allowed) return;\r\n        }\r\n\r\n        await startVoiceChat(false);\r\n        setError(null);\r\n        console.log(\"üé§ Voice chat started\");\r\n      } else {\r\n        console.log(\"üîá Stopping microphone...\");\r\n        await stopVoiceChat();\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"‚ùå Mic start error:\", err);\r\n      setError(err.message || \"Microphone error\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      <button\r\n        onClick={toggleMic}\r\n        className=\"w-12 h-12 rounded-full flex items-center justify-center transition-all bg-gray-700 hover:bg-gray-600 active:scale-95\"\r\n        style={{ WebkitTapHighlightColor: 'transparent' }}\r\n        title={isVoiceChatActive ? 'Mute' : 'Unmute'}\r\n      >\r\n        {/* MIC ON */}\r\n        {!isVoiceChatActive && (\r\n          <svg\r\n            className=\"w-6 h-6\"\r\n            stroke=\"white\"\r\n            fill=\"none\"\r\n            strokeWidth=\"2\"\r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path d=\"M12 1a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z\" />\r\n            <path d=\"M19 10a7 7 0 1 1-14 0\" />\r\n          </svg>\r\n        )}\r\n\r\n        {/* MIC OFF */}\r\n        {isVoiceChatActive && (\r\n          <svg\r\n            className=\"w-6 h-6\"\r\n            stroke=\"white\"\r\n            fill=\"none\"\r\n            strokeWidth=\"2\"\r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path d=\"M9 9v3a3 3 0 0 0 6 0V9M12 3v2m0 10v6m5-6a5 5 0 0 1-10 0m12-4a9 9 0 0 1-18 0\" />\r\n          </svg>\r\n        )}\r\n      </button>\r\n\r\n      {/* ERROR BUBBLE */}\r\n      {error && (\r\n        <div className=\"absolute top-14 right-0 bg-red-600 text-white text-xs px-3 py-2 rounded-lg shadow-lg max-w-[200px]\">\r\n          {error}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAKO,MAAM,0BAA0B;;IACrC,MAAM,EAAE,cAAc,EAAE,aAAa,EAAE,iBAAiB,EAAE,GAAG,IAAA,gKAAY;IACzE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IACzC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAgB;IAElD,IAAA,0KAAS;6CAAC;YACR,MAAM,SACJ,+CAAkB,eAClB,4BAA4B,IAAI,CAAC,UAAU,SAAS;YAEtD,YAAY;QACd;4CAAG,EAAE;IAEL,MAAM,uBAAuB;QAC3B,IAAI;YACF,QAAQ,GAAG,CAAC;YACZ,MAAM,SAAS,MAAM,UAAU,YAAY,CAAC,YAAY,CAAC;gBAAE,OAAO;YAAK;YAEvE,+CAA+C;YAC/C,OAAO,SAAS,GAAG,OAAO,CAAC,CAAC,IAAM,EAAE,IAAI;YAExC,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT,EAAE,OAAO,KAAU;YACjB,QAAQ,KAAK,CAAC,mCAAmC;YACjD,SAAS;YACT,OAAO;QACT;IACF;IAEA,MAAM,YAAY;QAChB,IAAI;YACF,IAAI,CAAC,mBAAmB;gBACtB,QAAQ,GAAG,CAAC;gBAEZ,kCAAkC;gBAClC,sCAAsC;gBACtC,kCAAkC;gBAClC,IAAI,UAAU;oBACZ,MAAM,UAAU,MAAM;oBACtB,IAAI,CAAC,SAAS;gBAChB;gBAEA,MAAM,eAAe;gBACrB,SAAS;gBACT,QAAQ,GAAG,CAAC;YACd,OAAO;gBACL,QAAQ,GAAG,CAAC;gBACZ,MAAM;YACR;QACF,EAAE,OAAO,KAAU;YACjB,QAAQ,KAAK,CAAC,sBAAsB;YACpC,SAAS,IAAI,OAAO,IAAI;QAC1B;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBACC,SAAS;gBACT,WAAU;gBACV,OAAO;oBAAE,yBAAyB;gBAAc;gBAChD,OAAO,oBAAoB,SAAS;;oBAGnC,CAAC,mCACA,6LAAC;wBACC,WAAU;wBACV,QAAO;wBACP,MAAK;wBACL,aAAY;wBACZ,SAAQ;;0CAER,6LAAC;gCAAK,GAAE;;;;;;0CACR,6LAAC;gCAAK,GAAE;;;;;;;;;;;;oBAKX,mCACC,6LAAC;wBACC,WAAU;wBACV,QAAO;wBACP,MAAK;wBACL,aAAY;wBACZ,SAAQ;kCAER,cAAA,6LAAC;4BAAK,GAAE;;;;;;;;;;;;;;;;;YAMb,uBACC,6LAAC;gBAAI,WAAU;0BACZ;;;;;;;;;;;;AAKX;GApGa;;QACkD,gKAAY;;;KAD9D","debugId":null}},
    {"offset": {"line": 979, "column": 0}, "map": {"version":3,"sources":["file:///Users/deyagharaibeh/Desktop/Runpod/components/ErrorMessage.tsx"],"sourcesContent":["interface ErrorMessageProps {\n  title?: string;\n  message: string;\n  onRetry?: () => void;\n  onDismiss?: () => void;\n}\n\nexport default function ErrorMessage({\n  title = 'Error',\n  message,\n  onRetry,\n  onDismiss,\n}: ErrorMessageProps) {\n  return (\n    <div className=\"bg-white rounded-2xl border-2 border-red-200 p-6 shadow-lg animate-slide-down\">\n      <div className=\"flex items-start gap-4\">\n        <div className=\"text-4xl flex-shrink-0\">‚ö†Ô∏è</div>\n        <div className=\"flex-1 min-w-0\">\n          <h3 className=\"text-lg font-bold text-red-800 mb-2\">{title}</h3>\n          <p className=\"text-red-700 mb-4 leading-relaxed\">{message}</p>\n          <div className=\"flex gap-3 flex-wrap\">\n            {onRetry && (\n              <button\n                onClick={onRetry}\n                className=\"px-5 py-2.5 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-all duration-200 text-sm font-semibold shadow-sm hover:shadow-md\"\n              >\n                Try Again\n              </button>\n            )}\n            {onDismiss && (\n              <button\n                onClick={onDismiss}\n                className=\"px-5 py-2.5 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-all duration-200 text-sm font-medium\"\n              >\n                Dismiss\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":";;;;;;AAOe,SAAS,aAAa,EACnC,QAAQ,OAAO,EACf,OAAO,EACP,OAAO,EACP,SAAS,EACS;IAClB,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;8BAAyB;;;;;;8BACxC,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAG,WAAU;sCAAuC;;;;;;sCACrD,6LAAC;4BAAE,WAAU;sCAAqC;;;;;;sCAClD,6LAAC;4BAAI,WAAU;;gCACZ,yBACC,6LAAC;oCACC,SAAS;oCACT,WAAU;8CACX;;;;;;gCAIF,2BACC,6LAAC;oCACC,SAAS;oCACT,WAAU;8CACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASf;KAnCwB","debugId":null}},
    {"offset": {"line": 1073, "column": 0}, "map": {"version":3,"sources":["file:///Users/deyagharaibeh/Desktop/Runpod/components/heygen/hooks/useTextChat.ts"],"sourcesContent":["\"use client\";\r\n\r\nimport { TaskMode, TaskType } from \"@heygen/streaming-avatar\";\r\nimport { useCallback } from \"react\";\r\n\r\nimport { useStreamingAvatarContext } from \"../StreamingAvatarProvider\";\r\n\r\nexport const useTextChat = () => {\r\n  const { avatarRef } = useStreamingAvatarContext();\r\n\r\n  const sendMessage = useCallback(\r\n    (message: string) => {\r\n      if (!avatarRef.current) return;\r\n      avatarRef.current.speak({\r\n        text: message,\r\n        taskType: TaskType.TALK,\r\n        taskMode: TaskMode.ASYNC,\r\n      });\r\n    },\r\n    [avatarRef],\r\n  );\r\n\r\n  const sendMessageSync = useCallback(\r\n    async (message: string) => {\r\n      if (!avatarRef.current) return;\r\n\r\n      return await avatarRef.current?.speak({\r\n        text: message,\r\n        taskType: TaskType.TALK,\r\n        taskMode: TaskMode.SYNC,\r\n      });\r\n    },\r\n    [avatarRef],\r\n  );\r\n\r\n  return {\r\n    sendMessage,\r\n    sendMessageSync,\r\n  };\r\n};\r\n\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAEA;;AALA;;;;AAOO,MAAM,cAAc;;IACzB,MAAM,EAAE,SAAS,EAAE,GAAG,IAAA,gLAAyB;IAE/C,MAAM,cAAc,IAAA,4KAAW;gDAC7B,CAAC;YACC,IAAI,CAAC,UAAU,OAAO,EAAE;YACxB,UAAU,OAAO,CAAC,KAAK,CAAC;gBACtB,MAAM;gBACN,UAAU,qLAAQ,CAAC,IAAI;gBACvB,UAAU,qLAAQ,CAAC,KAAK;YAC1B;QACF;+CACA;QAAC;KAAU;IAGb,MAAM,kBAAkB,IAAA,4KAAW;oDACjC,OAAO;YACL,IAAI,CAAC,UAAU,OAAO,EAAE;YAExB,OAAO,MAAM,UAAU,OAAO,EAAE,MAAM;gBACpC,MAAM;gBACN,UAAU,qLAAQ,CAAC,IAAI;gBACvB,UAAU,qLAAQ,CAAC,IAAI;YACzB;QACF;mDACA;QAAC;KAAU;IAGb,OAAO;QACL;QACA;IACF;AACF;GAhCa;;QACW,gLAAyB","debugId":null}},
    {"offset": {"line": 1129, "column": 0}, "map": {"version":3,"sources":["file:///Users/deyagharaibeh/Desktop/Runpod/components/heygen/ChatInput.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback, KeyboardEvent } from \"react\";\nimport { useTextChat } from \"./hooks/useTextChat\";\n\nexport const ChatInput = () => {\n  const { sendMessage } = useTextChat();\n  const [message, setMessage] = useState(\"\");\n\n  const handleSend = useCallback(() => {\n    if (message.trim() === \"\") {\n      return;\n    }\n    \n    const messageText = message.trim();\n    console.log('üí¨ Sending text message:', messageText);\n    \n    // Send the message to the avatar\n    // The SDK will handle adding it to message history via USER_TALKING_MESSAGE event\n    // if it triggers that event. If not, we may need to add it manually, but let's\n    // test first to see if the SDK handles it automatically.\n    sendMessage(messageText);\n    setMessage(\"\");\n  }, [message, sendMessage]);\n\n  const handleKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  };\n\n  return (\n    <div className=\"flex gap-2 items-center w-full\">\n      <input\n        type=\"text\"\n        value={message}\n        onChange={(e) => setMessage(e.target.value)}\n        onKeyDown={handleKeyDown}\n        placeholder=\"Type your message...\"\n        className=\"flex-1 bg-white text-gray-900 text-sm sm:text-base px-4 py-3 sm:py-2.5 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 placeholder:text-gray-400 min-h-[44px] touch-manipulation\"\n        autoComplete=\"off\"\n        style={{ WebkitTapHighlightColor: 'transparent' }}\n      />\n      <button\n        onClick={handleSend}\n        disabled={!message.trim()}\n        className=\"bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-gray-300 disabled:cursor-not-allowed text-white p-3 sm:p-2.5 rounded-lg transition-all duration-200 flex items-center justify-center touch-manipulation flex-shrink-0 min-w-[44px] min-h-[44px] shadow-md active:scale-95\"\n        title=\"Send message (Enter)\"\n        style={{ WebkitTapHighlightColor: 'transparent' }}\n      >\n        <svg\n          className=\"w-5 h-5 sm:w-5 sm:h-5\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          viewBox=\"0 0 24 24\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n        >\n          <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\" />\n          <polygon points=\"22 2 15 22 11 13 2 9 22 2\" />\n        </svg>\n      </button>\n    </div>\n  );\n};\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAKO,MAAM,YAAY;;IACvB,MAAM,EAAE,WAAW,EAAE,GAAG,IAAA,8JAAW;IACnC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,MAAM,aAAa,IAAA,4KAAW;6CAAC;YAC7B,IAAI,QAAQ,IAAI,OAAO,IAAI;gBACzB;YACF;YAEA,MAAM,cAAc,QAAQ,IAAI;YAChC,QAAQ,GAAG,CAAC,4BAA4B;YAExC,iCAAiC;YACjC,kFAAkF;YAClF,+EAA+E;YAC/E,yDAAyD;YACzD,YAAY;YACZ,WAAW;QACb;4CAAG;QAAC;QAAS;KAAY;IAEzB,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,WAAW,CAAC,EAAE,QAAQ,EAAE;YACpC,EAAE,cAAc;YAChB;QACF;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBACC,MAAK;gBACL,OAAO;gBACP,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;gBAC1C,WAAW;gBACX,aAAY;gBACZ,WAAU;gBACV,cAAa;gBACb,OAAO;oBAAE,yBAAyB;gBAAc;;;;;;0BAElD,6LAAC;gBACC,SAAS;gBACT,UAAU,CAAC,QAAQ,IAAI;gBACvB,WAAU;gBACV,OAAM;gBACN,OAAO;oBAAE,yBAAyB;gBAAc;0BAEhD,cAAA,6LAAC;oBACC,WAAU;oBACV,MAAK;oBACL,QAAO;oBACP,SAAQ;oBACR,aAAY;oBACZ,eAAc;oBACd,gBAAe;;sCAEf,6LAAC;4BAAK,IAAG;4BAAK,IAAG;4BAAI,IAAG;4BAAK,IAAG;;;;;;sCAChC,6LAAC;4BAAQ,QAAO;;;;;;;;;;;;;;;;;;;;;;;AAK1B;GA7Da;;QACa,8JAAW;;;KADxB","debugId":null}},
    {"offset": {"line": 1255, "column": 0}, "map": {"version":3,"sources":["file:///Users/deyagharaibeh/Desktop/Runpod/app/live/page.tsx"],"sourcesContent":["'use client';\n\nimport {\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n  Suspense,\n} from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport {\n  AvatarQuality,\n  ElevenLabsModel,\n  STTProvider,\n  StartAvatarRequest,\n  VoiceChatTransport,\n  VoiceEmotion,\n} from '@heygen/streaming-avatar';\n\nimport { useAuth } from '@/lib/auth-context';\nimport { apiClient } from '@/lib/api-client';\nimport { Session, TranscriptEntry } from '@/types';\nimport {\n  MessageSender,\n  StreamingAvatarProvider,\n  StreamingAvatarSessionState,\n  setKnowledgeBaseId,\n} from '@/components/heygen/StreamingAvatarProvider';\nimport { useStreamingAvatarSession } from '@/components/heygen/hooks/useStreamingAvatarSession';\nimport { useVoiceChat } from '@/components/heygen/hooks/useVoiceChat';\nimport { useMessageHistory } from '@/components/heygen/hooks/useMessageHistory';\nimport { AvatarVideo } from '@/components/heygen/AvatarVideo';\nimport { MessageHistory } from '@/components/heygen/MessageHistory';\nimport { MicrophoneButtonControl } from '@/components/heygen/MicrophoneButtonControl';\nimport ErrorMessage from '@/components/ErrorMessage';\nimport { ChatInput } from '@/components/heygen/ChatInput';\n\nconst HEYGEN_BASE_PATH =\n  process.env.NEXT_PUBLIC_HEYGEN_BASE_API_URL ||\n  process.env.NEXT_PUBLIC_BASE_API_URL ||\n  'https://api.heygen.com';\n\nconst mapQuality = (value?: string): AvatarQuality => {\n  switch ((value || '').toLowerCase()) {\n    case 'high':\n      return AvatarQuality.High;\n    case 'medium':\n      return AvatarQuality.Medium;\n    default:\n      return AvatarQuality.Low;\n  }\n};\n\nfunction LiveSessionContent() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n   const sessionId = searchParams?.get('sessionId') || null;\n  const { user, isAuthenticated, loading: authLoading } = useAuth();\n\n  const {\n    avatarRef,\n    startAvatar,\n    stopAvatar,\n    sessionState,\n    stream,\n  } = useStreamingAvatarSession();\n  const { startVoiceChat, stopVoiceChat, isVoiceChatActive } = useVoiceChat();\n  const { messages } = useMessageHistory();\n\n  const [session, setSession] = useState<Session | null>(null);\n  const [sessionConfig, setSessionConfig] = useState<StartAvatarRequest | null>(\n    null,\n  );\n  const [transcript, setTranscript] = useState<TranscriptEntry[]>([]);\n  const [sessionTime, setSessionTime] = useState(0);\n  const [isStartingAvatar, setIsStartingAvatar] = useState(false);\n  const [loadError, setLoadError] = useState<string | null>(null);\n  const [showTranscription, setShowTranscription] = useState(false); // Default to closed\n  const [micError, setMicError] = useState<string | null>(null);\n  const [fatalError, setFatalError] = useState<string | null>(null);\n\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\n  const [messageTimes, setMessageTimes] = useState<Record<string, number>>({});\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const voiceChatStartedRef = useRef(false);\n  const isEndingSessionRef = useRef(false);\n  const messagesContainerRef = useRef<HTMLDivElement>(null);\n\n  const isAvatarReady =\n    sessionState === StreamingAvatarSessionState.CONNECTED;\n\n  const startTimer = useCallback(() => {\n    if (timerRef.current) clearInterval(timerRef.current);\n    timerRef.current = setInterval(\n      () => setSessionTime((prev) => prev + 1),\n      1000,\n    );\n  }, []);\n\n  const loadSession = useCallback(async () => {\n    if (!sessionId) return;\n    try {\n      let sessionData: Session | null = null;\n      try {\n        const response = await apiClient.get<any>(`/api/sessions/${sessionId}`);\n        if (response.success) {\n          sessionData = response.session;\n          // Save to localStorage as backup\n          if (typeof window !== 'undefined' && sessionData) {\n            localStorage.setItem(`session_${sessionId}`, JSON.stringify(sessionData));\n            console.log('üíæ Session loaded from API and saved to localStorage');\n          }\n        }\n      } catch (apiError: any) {\n        console.warn('‚ö†Ô∏è Failed to load from API, trying localStorage...', apiError?.response?.status);\n        const storedSession = localStorage.getItem(`session_${sessionId}`);\n        if (storedSession) {\n          sessionData = JSON.parse(storedSession);\n          console.log('‚úÖ Session loaded from localStorage');\n        } else {\n          throw apiError;\n        }\n      }\n\n      if (!sessionData) {\n        throw new Error('Session not found');\n      }\n\n      setSession(sessionData);\n      // Get the selected language (full locale format like 'es-ES')\n      const selectedLanguage = sessionData.language || 'en-US';\n      // Extract language code (e.g., 'es' from 'es-ES') for STT\n      const languageCode = selectedLanguage.split('-')[0];\n      console.log('üåç Selected language:', selectedLanguage);\n      console.log('üìù Using language code for STT:', languageCode);\n\n      // Convert uploaded KB to HeyGen KB if needed (before creating config)\n      // If no KB in session, use default KB\n      let finalKnowledgeId = sessionData.knowledgeBaseId || undefined;\n      if (!finalKnowledgeId) {\n        // No KB in session - use default KB\n        console.log('üìö No knowledgeBaseId in session, using default KB');\n        finalKnowledgeId = '00000000-0000-0000-0000-000000000001';\n        console.log('   - Default KB ID:', finalKnowledgeId);\n        console.log('   - Default KB: Legal Interview Protocol');\n      } else {\n        console.log('üìö Session knowledgeBaseId:', finalKnowledgeId);\n      }\n      \n      if (finalKnowledgeId) {\n        try {\n          console.log('üîÑ Converting knowledge base to HeyGen KB:', finalKnowledgeId);\n          console.log('   - KB ID format:', finalKnowledgeId.startsWith('kb_') ? 'HeyGen format' : 'UUID format (likely uploaded/default)');\n          const selectedLanguage = sessionData.language || 'en-US';\n          console.log('   - Language for KB:', selectedLanguage);\n          const convertResponse = await apiClient.post<any>('/api/heygen/convert-kb', {\n            knowledgeId: finalKnowledgeId,\n            language: selectedLanguage, // Pass language to include in KB instructions\n            sessionId: sessionId, // Pass sessionId to get difficulty for prompt combination\n          });\n          \n          console.log('üìã Convert KB response:', convertResponse);\n          if (convertResponse.success && convertResponse.knowledgeId) {\n            finalKnowledgeId = convertResponse.knowledgeId;\n            console.log('‚úÖ Converted to HeyGen KB ID:', finalKnowledgeId);\n            console.log('   - Is HeyGen KB:', convertResponse.isHeyGenKB || false);\n            console.log('   - Cached:', convertResponse.cached || false);\n          } else {\n            console.warn('‚ö†Ô∏è KB conversion failed or returned no knowledgeId');\n            console.warn('   - Response:', convertResponse);\n            \n            // Show warning if API key is required\n            if (convertResponse.requiresApiKey) {\n              const errorMsg = convertResponse.message || 'HeyGen API key is required to use knowledge bases';\n              console.warn('‚ö†Ô∏è', errorMsg);\n              setLoadError(`Warning: ${errorMsg}. The session will continue without the knowledge base.`);\n            }\n          }\n        } catch (convertError: any) {\n          console.error('‚ùå Error converting KB:', convertError);\n          console.error('   - Error message:', convertError.message);\n          \n          // Extract error details from response\n          const errorData = convertError.response?.data;\n          const errorMessage = errorData?.message || convertError.message || 'Failed to convert knowledge base';\n          const requiresApiKey = errorData?.requiresApiKey || false;\n          \n          if (requiresApiKey) {\n            // Show a clear warning about missing API key\n            const warningMsg = `HeyGen API key not configured. ${errorMessage}. The session will continue, but the knowledge base may not work properly.`;\n            console.warn('‚ö†Ô∏è', warningMsg);\n            setLoadError(warningMsg);\n          } else {\n            // For other errors, just log them but continue\n            console.warn('‚ö†Ô∏è KB conversion failed, continuing with original KB ID');\n          }\n          // Continue with original ID\n        }\n      } else {\n        console.log('‚ö†Ô∏è No knowledgeBaseId in session - avatar will start without KB');\n      }\n\n      // Build config - use language code (e.g., 'es' not 'es-ES') for HeyGen API\n      // The SDK passes language to the API, but it may need the language code format\n      const config: StartAvatarRequest = {\n        quality: mapQuality(sessionData.quality),\n        avatarName: sessionData.avatarId,\n        knowledgeId: finalKnowledgeId, // Use converted HeyGen KB ID\n        language: languageCode, // Use language code (e.g., 'es', 'it', 'fr') instead of full locale\n        voiceChatTransport: VoiceChatTransport.WEBSOCKET,\n        voice: {\n          rate: 1.15,\n          emotion: VoiceEmotion.EXCITED,\n          model: ElevenLabsModel.eleven_flash_v2_5,\n        },\n        sttSettings: {\n          provider: STTProvider.DEEPGRAM,\n        },\n      };\n      \n      console.log('üìã Session language (full locale):', selectedLanguage);\n      console.log('üìã STT language code:', languageCode);\n      \n      console.log('üìã Session config created:', {\n        avatarName: config.avatarName,\n        quality: config.quality,\n        hasKnowledgeId: !!config.knowledgeId,\n      });\n      \n      // Set knowledge base ID for YTL LLM (uploaded KBs, not HeyGen KBs)\n      // Note: We still pass knowledgeId to HeyGen for compatibility, but YTL LLM will use uploaded KBs\n      if (sessionData.knowledgeBaseId) {\n        setKnowledgeBaseId(sessionData.knowledgeBaseId);\n        console.log('üìö Knowledge base ID set for YTL LLM:', sessionData.knowledgeBaseId);\n      } else {\n        setKnowledgeBaseId(undefined);\n      }\n\n      setSessionConfig(config);\n      setLoadError(null);\n    } catch (error: any) {\n      console.error('Failed to load session', error);\n      const message = error.message ?? 'Failed to load session.';\n      setLoadError(message);\n      setFatalError(`Failed to load session: ${message}`);\n    }\n  }, [router, sessionId]);\n\n  useEffect(() => {\n    if (authLoading) return;\n    if (!isAuthenticated) {\n      router.push('/login');\n      return;\n    }\n    if (!sessionId) {\n      router.push('/lobby');\n      return;\n    }\n    loadSession();\n    startTimer();\n\n    return () => {\n      if (timerRef.current) clearInterval(timerRef.current);\n    };\n  }, [isAuthenticated, authLoading, loadSession, router, sessionId, startTimer]);\n\n  useEffect(() => {\n    console.log('üîç useEffect triggered:', {\n      hasSessionConfig: !!sessionConfig,\n      isStartingAvatar,\n      sessionState,\n      expectedState: StreamingAvatarSessionState.INACTIVE,\n    });\n    \n    if (!sessionConfig) {\n      console.log('‚è∏Ô∏è Waiting for session config...');\n      return;\n    }\n    if (isStartingAvatar) {\n      console.log('‚è∏Ô∏è Avatar is already starting...');\n      return;\n    }\n    if (sessionState !== StreamingAvatarSessionState.INACTIVE) {\n      console.log('‚è∏Ô∏è Session state is not INACTIVE, current state:', sessionState);\n      return;\n    }\n\n    // Use a ref to track cancellation so it persists across renders\n    const cancelledRef = { current: false };\n    let connectionTimeout: NodeJS.Timeout | null = null;\n\n    const startSession = async () => {\n      // Don't start if we're ending the session\n      if (isEndingSessionRef.current) {\n        console.log('‚èπÔ∏è Session is ending, skipping start');\n        return;\n      }\n      \n      try {\n        console.log('üé¨ startSession function called');\n        setIsStartingAvatar(true);\n        console.log('üé≠ Starting HeyGen session...');\n        console.log('üìã Config:', JSON.stringify(sessionConfig, null, 2));\n        console.log('üåê Base path:', HEYGEN_BASE_PATH || 'not set');\n        console.log('üìä Session state at start:', sessionState);\n\n        // Set a timeout to detect if connection hangs\n        connectionTimeout = setTimeout(() => {\n          if (!cancelledRef.current) {\n            console.error('‚è±Ô∏è Connection timeout - avatar took too long to connect');\n            setLoadError('Connection timeout. Please check your network and try again.');\n            setIsStartingAvatar(false);\n          }\n        }, 30000); // 30 second timeout\n\n        // Fetch token\n        console.log('üîë Fetching HeyGen token...');\n        const response = await fetch('/api/heygen/token', { method: 'POST' });\n        if (!response.ok) {\n          const errorText = await response.text().catch(() => 'Unknown error');\n          console.error('‚ùå Token fetch failed:', response.status, errorText);\n          setLoadError(`Failed to fetch HeyGen token (${response.status}). Please check your API configuration.`);\n          setIsStartingAvatar(false);\n          if (connectionTimeout) clearTimeout(connectionTimeout);\n          return;\n        }\n        \n        // Check content type to determine if it's JSON or text\n        const contentType = response.headers.get('content-type');\n        let token: string;\n        \n        try {\n          if (contentType?.includes('application/json')) {\n            const data = await response.json();\n            token = data?.token || data;\n            console.log('‚úÖ Token received (JSON):', token ? token.substring(0, 20) + '...' : 'empty');\n        } else {\n            token = await response.text();\n            console.log('‚úÖ Token received (text):', token ? token.substring(0, 20) + '...' : 'empty');\n          }\n          \n          if (!token || token.trim() === '') {\n            throw new Error('Received empty token from API');\n          }\n        } catch (tokenError) {\n          console.error('‚ùå Error parsing token:', tokenError);\n          setLoadError('Failed to parse token from server response.');\n          setIsStartingAvatar(false);\n          if (connectionTimeout) clearTimeout(connectionTimeout);\n          return;\n        }\n        \n        console.log('‚úÖ Token validated, length:', token.length);\n        console.log('üîç Checking cancelled flag:', cancelledRef.current);\n\n        if (cancelledRef.current) {\n          console.log('‚èπÔ∏è Session cancelled, aborting...');\n          return;\n        }\n\n        console.log('‚úÖ Not cancelled, proceeding to start avatar...');\n        \n        // Start avatar (it will initialize if needed)\n        console.log('üöÄ Starting avatar with config...');\n        console.log('üìã Full config object:', JSON.stringify(sessionConfig, null, 2));\n        console.log('üìä Current session state before startAvatar:', sessionState);\n        \n        try {\n        await startAvatar(sessionConfig, token);\n          console.log('‚úÖ Avatar started, waiting for stream...');\n        } catch (avatarError) {\n          console.error('‚ùå Error in startAvatar call:', avatarError);\n          console.error('‚ùå Error stack:', avatarError instanceof Error ? avatarError.stack : 'No stack');\n          throw avatarError; // Re-throw to be caught by outer try-catch\n        }\n\n        // Wait for the stream to be ready\n        // The STREAM_READY event will fire and update the state to CONNECTED\n        console.log('‚è≥ Waiting for stream to be ready...');\n        \n        // We'll start voice chat when the avatar becomes ready (CONNECTED state)\n        // This is handled in a separate useEffect that watches for isAvatarReady\n      } catch (error) {\n        console.error('‚ùå Failed to start HeyGen session:', error);\n        const errorMessage = error instanceof Error ? error.message : 'Failed to start avatar';\n        setLoadError(errorMessage);\n        setIsStartingAvatar(false);\n        console.error('Error details:', {\n          message: errorMessage,\n          config: sessionConfig,\n          basePath: HEYGEN_BASE_PATH,\n          sessionState,\n          error: error instanceof Error ? error.stack : String(error),\n        });\n        if (connectionTimeout) clearTimeout(connectionTimeout);\n      }\n    };\n\n    startSession();\n\n    return () => {\n      console.log('üßπ useEffect cleanup: setting cancelled flag');\n      cancelledRef.current = true;\n      if (connectionTimeout) {\n        clearTimeout(connectionTimeout);\n        connectionTimeout = null;\n      }\n      // Reset ending flag on cleanup (in case component unmounts)\n      isEndingSessionRef.current = false;\n    };\n  }, [\n    sessionConfig,\n    sessionState,\n    startAvatar,\n    // Note: isStartingAvatar is checked inside the effect, not in dependencies\n    // to prevent re-running when we set it to true\n  ]);\n\n  useEffect(() => {\n    if (!stream || !videoRef.current) return;\n    console.log('üìπ Setting video stream...');\n    videoRef.current.srcObject = stream;\n    videoRef.current.onloadedmetadata = () => {\n      console.log('‚úÖ Video metadata loaded, playing...');\n      videoRef.current?.play().catch((error) => {\n        console.error('‚ùå Failed to play video:', error);\n      });\n    };\n  }, [stream]);\n\n  // Clear loading state when avatar is ready\n  useEffect(() => {\n    if (isAvatarReady && isStartingAvatar) {\n      console.log('‚úÖ Avatar is ready, clearing loading state');\n      setIsStartingAvatar(false);\n    }\n  }, [isAvatarReady, isStartingAvatar]);\n\n  // Start voice chat automatically when avatar is ready (always unmuted by default)\n  // On mobile, microphone requires user interaction, so we don't auto-start\n  // Add a small delay to ensure the stream is fully ready\n  useEffect(() => {\n    // Check if we're on mobile\n    const isMobile = typeof window !== 'undefined' && /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);\n    \n    // On mobile, don't auto-start microphone (requires user interaction)\n    // User will need to click the microphone button to start\n    if (isMobile) {\n      console.log('üì± Mobile device detected - microphone will start on user click (requires user interaction)');\n      return;\n    }\n    \n    if (isAvatarReady && !isVoiceChatActive && !voiceChatStartedRef.current && avatarRef.current && stream) {\n      // Set flag immediately to prevent double start\n      voiceChatStartedRef.current = true;\n\n      // Wait a bit for the stream to be fully established\n      const startVoiceChatWithDelay = setTimeout(() => {\n        console.log('üé§ Avatar is ready, starting voice chat automatically (unmuted)...');\n        console.log('üìä Stream status:', {\n          hasStream: !!stream,\n          streamId: stream?.id,\n          tracks: stream?.getTracks().length,\n        });\n        \n        // Start voice chat with microphone unmuted (open) by default\n        startVoiceChat(false)\n          .then(() => {\n            console.log('‚úÖ Voice chat started successfully - microphone is OPEN (unmuted)');\n            setMicError(null); // Clear any previous errors\n          })\n          .catch((error) => {\n            console.error('‚ö†Ô∏è Failed to start voice chat:', error);\n            const errorMessage = error instanceof Error ? error.message : String(error);\n            console.error('Error message:', errorMessage);\n            setMicError(errorMessage);\n            voiceChatStartedRef.current = false; // Reset on error so we can retry\n          });\n      }, 1000); // Wait 1 second after stream is ready\n      \n      return () => {\n        clearTimeout(startVoiceChatWithDelay);\n      };\n    }\n  }, [isAvatarReady, isVoiceChatActive, startVoiceChat, stream, avatarRef]);\n\n  // Format session time to MM:SS or HH:MM:SS for transcript timestamps\n  const formatSessionTime = useCallback((seconds: number): string => {\n    const hours = Math.floor(seconds / 3600);\n    const mins = Math.floor((seconds % 3600) / 60);\n    const secs = Math.floor(seconds % 60);\n    \n    if (hours > 0) {\n      return `${hours}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;\n    }\n    return `${mins}:${String(secs).padStart(2, '0')}`;\n  }, []);\n\n  useEffect(() => {\n    setTranscript((prev) => {\n      const previousMap = new Map(prev.map((entry) => [entry.id, entry]));\n      return messages.map((message) => {\n        // Map AVATAR to 'interviewer' and CLIENT (user) to 'witness'\n        // The avatar asks questions (interviewer), the client responds (witness)\n        const speaker =\n          message.sender === MessageSender.CLIENT ? 'witness' : 'interviewer';\n        const existing = previousMap.get(message.id);\n        \n        // Use relative session time from messageTimes if available, otherwise use current sessionTime\n        const messageSessionTime = messageTimes[message.id] ?? sessionTime;\n        const relativeTimestamp = formatSessionTime(messageSessionTime);\n        \n        if (\n          existing &&\n          existing.text === message.content &&\n          existing.speaker === speaker &&\n          existing.timestamp === relativeTimestamp\n        ) {\n          return existing;\n        }\n        return {\n          id: message.id,\n          timestamp: relativeTimestamp, // Use relative session time (MM:SS or HH:MM:SS)\n          speaker,\n          text: message.content,\n        };\n      });\n    });\n  }, [messages, messageTimes, sessionTime, formatSessionTime]);\n\n  // Track the session time when each message was first received,\n  // so timestamps under messages reflect the session time at send.\n  useEffect(() => {\n    if (!messages.length) return;\n\n    setMessageTimes((prev) => {\n      let changed = false;\n      const next: Record<string, number> = { ...prev };\n\n      for (const msg of messages) {\n        if (next[msg.id] === undefined) {\n          next[msg.id] = sessionTime;\n          changed = true;\n        }\n      }\n\n      return changed ? next : prev;\n    });\n  }, [messages, sessionTime]);\n\n  // Auto-scroll messages container to bottom when new messages arrive\n  useEffect(() => {\n    if (messagesContainerRef.current && showTranscription) {\n      // Use setTimeout to ensure DOM has updated\n      setTimeout(() => {\n        if (messagesContainerRef.current) {\n          messagesContainerRef.current.scrollTop = messagesContainerRef.current.scrollHeight;\n        }\n      }, 100);\n    }\n  }, [messages, showTranscription]);\n\n  useEffect(() => {\n    return () => {\n      if (timerRef.current) clearInterval(timerRef.current);\n      stopVoiceChat();\n      stopAvatar();\n    };\n  }, [stopAvatar, stopVoiceChat]);\n\n  const formatTime = useCallback((seconds: number) => {\n    const hours = Math.floor(seconds / 3600)\n      .toString()\n      .padStart(2, '0');\n    const mins = Math.floor((seconds % 3600) / 60)\n      .toString()\n      .padStart(2, '0');\n    const secs = (seconds % 60).toString().padStart(2, '0');\n    return `${hours}:${mins}:${secs}`;\n  }, []);\n\n  const handleEndSession = useCallback(async () => {\n    // Set flag to prevent session from restarting\n    isEndingSessionRef.current = true;\n\n    if (timerRef.current) clearInterval(timerRef.current);\n    stopVoiceChat();\n    \n    // Stop avatar (don't await - let it clean up in background)\n    stopAvatar().catch((error) => {\n      console.warn('Error stopping avatar:', error);\n    });\n    \n    // Build fresh transcript from current messages to ensure we have the latest data\n    console.log('üîç Building transcript for saving:', {\n      messagesCount: messages.length,\n      transcriptStateLength: transcript.length,\n      messageTimesCount: Object.keys(messageTimes).length,\n      sessionTime,\n    });\n    \n    const freshTranscript: TranscriptEntry[] = messages\n      .map((message) => {\n        const speaker: 'interviewer' | 'witness' = message.sender === MessageSender.CLIENT ? 'witness' : 'interviewer';\n        const messageSessionTime = messageTimes[message.id] ?? sessionTime;\n        const relativeTimestamp = formatSessionTime(messageSessionTime);\n        \n        return {\n          id: message.id,\n          timestamp: relativeTimestamp,\n          speaker,\n          text: message.content || '',\n        };\n      })\n      .filter(entry => entry.text && entry.text.trim().length > 0); // Filter out empty messages\n    \n    console.log('üìù Fresh transcript built:', {\n      length: freshTranscript.length,\n      sampleEntries: freshTranscript.slice(0, 3),\n      witnessCount: freshTranscript.filter(t => t.speaker === 'witness').length,\n      interviewerCount: freshTranscript.filter(t => t.speaker === 'interviewer').length,\n    });\n    \n    // Use fresh transcript if available, otherwise fall back to state\n    const finalTranscript = freshTranscript.length > 0 ? freshTranscript : (transcript.length > 0 ? transcript : []);\n    \n    console.log('‚úÖ Final transcript to save:', {\n      length: finalTranscript.length,\n      source: freshTranscript.length > 0 ? 'fresh' : (transcript.length > 0 ? 'state' : 'empty'),\n    });\n    \n    // Validate transcript before saving\n    if (!finalTranscript || finalTranscript.length === 0) {\n      console.error('‚ùå Cannot save session: transcript is empty');\n      console.error('   Messages count:', messages.length);\n      console.error('   Messages:', messages.map(m => ({ sender: m.sender, content: m.content?.substring(0, 50) })));\n      console.error('   Transcript state length:', transcript.length);\n      console.error('   Fresh transcript length:', freshTranscript.length);\n      // Still navigate to report page, but show error there\n      router.push(`/report?sessionId=${sessionId}`);\n      return;\n    }\n    \n    // Validate transcript format\n    const invalidEntries = finalTranscript.filter(t => !t.speaker || !t.text || !t.timestamp);\n    if (invalidEntries.length > 0) {\n      console.warn('‚ö†Ô∏è Some transcript entries are missing required fields:', invalidEntries);\n      console.warn('   Total invalid entries:', invalidEntries.length, 'out of', finalTranscript.length);\n    }\n    \n    // Log transcript details for debugging\n    console.log('üìã Transcript details:', {\n      totalEntries: finalTranscript.length,\n      witnessEntries: finalTranscript.filter(t => t.speaker?.toLowerCase() === 'witness').length,\n      interviewerEntries: finalTranscript.filter(t => t.speaker?.toLowerCase() === 'interviewer').length,\n      sampleEntry: finalTranscript[0],\n      usingFreshTranscript: freshTranscript.length > 0,\n    });\n    \n    // Save session data in background (non-blocking)\n    console.log('üíæ Saving session transcript:', {\n      sessionId,\n      transcriptLength: finalTranscript.length,\n      duration: sessionTime,\n      transcriptPreview: finalTranscript.slice(0, 3),\n      hasMessages: messages.length > 0,\n    });\n    \n    // Always save to localStorage first as immediate backup\n    if (typeof window !== 'undefined' && session) {\n      try {\n        const sessionToSave = {\n          ...session,\n          transcript: finalTranscript,\n          endTime: new Date().toISOString(),\n          duration: sessionTime,\n        };\n        localStorage.setItem(`session_${sessionId}`, JSON.stringify(sessionToSave));\n        console.log('üíæ Session saved to localStorage immediately (before API call)');\n        console.log('   Transcript length in localStorage:', sessionToSave.transcript.length);\n      } catch (localError) {\n        console.error('‚ùå Failed to save to localStorage:', localError);\n      }\n    }\n    \n    try {\n      const updateResponse = await apiClient.put<{ success: boolean; session: Session }>(`/api/sessions/${sessionId}`, {\n        transcript: finalTranscript,\n        endTime: new Date().toISOString(),\n        duration: sessionTime,\n      });\n      console.log('‚úÖ Session transcript saved successfully to API');\n      \n      // Update localStorage with server response if it has transcript, otherwise keep our local version\n      if (typeof window !== 'undefined') {\n        const sessionToSave = updateResponse?.session && updateResponse.session.transcript?.length > 0\n          ? updateResponse.session\n          : {\n              ...session,\n              transcript: finalTranscript,\n              endTime: new Date().toISOString(),\n              duration: sessionTime,\n            };\n        localStorage.setItem(`session_${sessionId}`, JSON.stringify(sessionToSave));\n        console.log('üíæ Session updated in localStorage after API call');\n        console.log('   Transcript length in localStorage:', sessionToSave.transcript.length);\n      }\n    } catch (error: any) {\n      console.error('‚ùå Failed to update session transcript:', {\n        error: error?.response?.data || error?.message || error,\n        status: error?.response?.status,\n        url: error?.config?.url,\n      });\n      \n      // Even if API fails, try to save to localStorage as backup\n      if (typeof window !== 'undefined' && session) {\n        try {\n          const updatedSession = {\n            ...session,\n            transcript: finalTranscript,\n            endTime: new Date().toISOString(),\n            duration: sessionTime,\n          };\n          localStorage.setItem(`session_${sessionId}`, JSON.stringify(updatedSession));\n          console.log('üíæ Session saved to localStorage as backup (API update failed)');\n          console.log('   Saved transcript length:', finalTranscript.length);\n          console.log('   Saved session keys:', Object.keys(updatedSession));\n          console.log('   Sample transcript entry:', finalTranscript[0]);\n          \n          // Verify it was saved correctly\n          const verification = localStorage.getItem(`session_${sessionId}`);\n          if (verification) {\n            const parsed = JSON.parse(verification);\n            console.log('   Verification - transcript length in localStorage:', parsed.transcript?.length || 0);\n          }\n        } catch (localError) {\n          console.error('‚ùå Failed to save to localStorage:', localError);\n        }\n      }\n    }\n\n    // Generate analysis in background (non-blocking) via Next.js analysis API\n    // Fetch KB content if we have a knowledgeBaseId from the session (uploaded KB)\n    // Skip fetching if it's the default KB ID (not stored in knowledge base storage)\n    let kbContent = '';\n    const defaultKBId = '00000000-0000-0000-0000-000000000001';\n    if (session?.knowledgeBaseId && session.knowledgeBaseId !== defaultKBId) {\n      try {\n        console.log('üìö Fetching KB content for analysis:', session.knowledgeBaseId);\n        const kbResponse = await apiClient.get<any>(`/api/knowledge-base/${session.knowledgeBaseId}`);\n        if (kbResponse.success && kbResponse.knowledgeBase?.content) {\n          kbContent = kbResponse.knowledgeBase.content;\n          console.log(`‚úÖ KB content fetched: ${kbContent.length} characters`);\n        } else {\n          console.warn('‚ö†Ô∏è Could not fetch KB content, analysis will proceed without it');\n        }\n      } catch (kbError) {\n        console.error('‚ùå Error fetching KB content:', kbError);\n        // Continue without KB content\n      }\n    } else if (session?.knowledgeBaseId === defaultKBId) {\n      console.log('üìö Default KB ID detected - skipping KB fetch (will use difficulty prompt for avatar, but no KB for analysis)');\n    }\n    \n    console.log('üìä Starting analysis generation...', {\n      transcriptLength: finalTranscript.length,\n      durationSeconds: sessionTime,\n      knowledgeBaseId: session?.knowledgeBaseId || 'None',\n      hasKbContent: !!kbContent,\n    });\n    \n    try {\n      const analysisResponse = await apiClient.post<any>(\n        '/api/analysis/session',\n        {\n          transcript: finalTranscript,\n          durationSeconds: sessionTime,\n          knowledgeBase: kbContent, // Pass KB content, not ID\n        },\n      );\n      \n      console.log('üìä Analysis response received:', {\n        success: analysisResponse?.success,\n        hasAnalysis: !!analysisResponse?.analysis,\n        hasReport: !!analysisResponse?.report,\n      });\n      \n      // Transform analysis response to report format (API returns 'analysis', not 'report')\n      if (analysisResponse?.success && analysisResponse?.analysis) {\n        const analysis = analysisResponse.analysis;\n        const overallScore = Math.round(\n          (analysis.accuracy + analysis.clarity + analysis.completeness + analysis.consistency) / 4\n        );\n        \n        const report = {\n          overallScore: overallScore,\n          metrics: {\n            accuracy: analysis.accuracy || 0,\n            clarity: analysis.clarity || 0,\n            tone: analysis.consistency || 0, // Map consistency to tone\n            pace: analysis.completeness || 0, // Map completeness to pace\n            consistency: analysis.consistency || 0,\n          },\n          highlights: analysis.highlights || [],\n          recommendations: analysis.recommendations || [],\n          durationSeconds: sessionTime,\n          summary: analysis.summary || 'Analysis completed successfully.',\n          flaggedSegments: analysis.flaggedSegments || [],\n        };\n        console.log('üíæ Saving analysis report to session...');\n        try {\n          const updateResponse = await apiClient.put<{ success: boolean; session: Session }>(`/api/sessions/${sessionId}`, { report });\n          console.log('‚úÖ Analysis report saved successfully');\n          \n          // Also update localStorage as backup\n          if (typeof window !== 'undefined' && updateResponse?.session) {\n            localStorage.setItem(`session_${sessionId}`, JSON.stringify(updateResponse.session));\n            console.log('üíæ Session with report updated in localStorage');\n          }\n        } catch (updateError: any) {\n          console.error('‚ùå Failed to save report to session:', {\n            error: updateError?.response?.data || updateError?.message || updateError,\n            status: updateError?.response?.status,\n          });\n          \n          // Even if API fails, try to save to localStorage as backup\n          if (typeof window !== 'undefined' && session) {\n            try {\n              const updatedSession = {\n                ...session,\n                report,\n              };\n              localStorage.setItem(`session_${sessionId}`, JSON.stringify(updatedSession));\n              console.log('üíæ Report saved to localStorage as backup (API update failed)');\n            } catch (localError) {\n              console.error('‚ùå Failed to save report to localStorage:', localError);\n            }\n          }\n        }\n      } else {\n        console.warn('‚ö†Ô∏è Analysis response missing report:', analysisResponse);\n      }\n    } catch (error: any) {\n      console.error('‚ùå Failed to generate or save analysis:', {\n        error: error?.response?.data || error?.message || error,\n        status: error?.response?.status,\n        url: error?.config?.url,\n        transcriptLength: transcript.length,\n      });\n    }\n\n    // Navigate immediately - don't wait for API calls\n    router.push(`/report?sessionId=${sessionId}`);\n  }, [router, sessionId, sessionTime, stopAvatar, stopVoiceChat, transcript, messages, messageTimes, session, sessionConfig, formatSessionTime]);\n\n  if (!isAuthenticated || !user) {\n    return null;\n  }\n\n  if (!session) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-16 w-16 border-4 border-brand-navy-900 border-t-transparent mx-auto mb-4\" />\n          <p className=\"text-lg font-medium text-brand-navy-900\">\n        Loading session...\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-200 flex items-center justify-center p-0.5 sm:p-2\">\n      {/* Centered fatal error overlay */}\n      {fatalError && (\n        <div className=\"fixed inset-0 z-40 flex items-center justify-center bg-black/40\">\n          <div className=\"max-w-md w-full px-4\">\n            <ErrorMessage\n              title=\"Unable to start session\"\n              message={fatalError}\n              onDismiss={() => {\n                setFatalError(null);\n                router.push('/lobby');\n              }}\n            />\n          </div>\n        </div>\n      )}\n      <div className=\"relative w-full max-w-[1920px] bg-white border border-gray-300 rounded-lg overflow-hidden shadow-2xl flex flex-col lg:flex-row\" style={{ minHeight: '400px', height: 'calc(100vh - 0.5rem)', maxHeight: 'calc(100vh - 0.5rem)' }}>\n        {/* Video Container - Full width on mobile, flex-1 on desktop */}\n        <div className=\"relative flex-1 bg-gray-100 flex items-center justify-center min-h-[300px] sm:min-h-[400px] overflow-hidden\">\n          <div className=\"relative w-full h-full bg-black flex items-center justify-center\">\n          <AvatarVideo ref={videoRef} />\n\n          {!isAvatarReady && (\n            <div className=\"absolute inset-0 flex items-center justify-center bg-black/70 text-white z-10\">\n              <div className=\"text-center px-4\">\n                <div className=\"animate-spin rounded-full h-12 w-12 sm:h-16 sm:w-16 border-4 border-white border-t-transparent mx-auto mb-3 sm:mb-4\" />\n                <p className=\"text-sm sm:text-base font-medium\">\n                  {isStartingAvatar ? 'Connecting avatar...' : 'Waiting for stream...'}\n                </p>\n                {loadError && (\n                  <div className=\"mt-3 sm:mt-4 p-3 sm:p-4 bg-red-900/50 rounded-lg max-w-md mx-auto\">\n                    <p className=\"text-xs sm:text-sm font-semibold text-red-200\">Error:</p>\n                    <p className=\"text-[10px] sm:text-xs text-red-100 mt-1 break-words\">{loadError}</p>\n                    <button\n                      onClick={() => {\n                        setLoadError(null);\n                        setIsStartingAvatar(false);\n                        window.location.reload();\n                      }}\n                      className=\"mt-2 px-4 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 active:bg-red-800 active:scale-95 text-xs sm:text-sm font-medium min-h-[44px] min-w-[80px] touch-manipulation transition-all duration-200\"\n                      style={{ WebkitTapHighlightColor: 'transparent' }}\n                    >\n                      Retry\n                    </button>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* Top-left: Session Time */}\n          <div className=\"absolute top-1.5 left-1.5 sm:top-3 sm:left-3 bg-blue-900 rounded-lg px-2 py-1 sm:px-3 sm:py-1.5 z-20\">\n            <p className=\"text-white text-[9px] sm:text-xs font-medium whitespace-nowrap\">\n              Session Time {formatTime(sessionTime)}\n            </p>\n          </div>\n\n          {/* Microphone Error Message */}\n          {micError && isAvatarReady && (\n            <div className=\"absolute top-1.5 right-1.5 sm:top-3 sm:right-3 bg-red-600 rounded-lg px-2.5 py-2 sm:px-3 sm:py-2 z-20 max-w-[85%] sm:max-w-xs\">\n              <div className=\"flex items-start gap-1.5 sm:gap-2\">\n                <svg\n                  className=\"w-3.5 h-3.5 sm:w-4 sm:h-4 text-white mt-0.5 flex-shrink-0\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n                  />\n                </svg>\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-white text-[10px] sm:text-xs font-semibold mb-0.5 sm:mb-1\">Microphone Error</p>\n                  <p className=\"text-white text-[9px] sm:text-[10px] leading-tight break-words\">{micError}</p>\n                  <button\n                    onClick={() => {\n                      setMicError(null);\n                      voiceChatStartedRef.current = false;\n                    }}\n                    className=\"mt-1.5 sm:mt-2 text-[9px] sm:text-xs text-white underline hover:no-underline active:opacity-70 min-h-[32px] min-w-[60px] touch-manipulation\"\n                    style={{ WebkitTapHighlightColor: 'transparent' }}\n                  >\n                    Dismiss\n                  </button>\n                </div>\n              <button\n                  onClick={() => setMicError(null)}\n                  className=\"text-white hover:text-gray-200 active:opacity-70 ml-0.5 sm:ml-1 min-w-[36px] min-h-[36px] sm:min-w-[44px] sm:min-h-[44px] flex items-center justify-center touch-manipulation flex-shrink-0\"\n                  style={{ WebkitTapHighlightColor: 'transparent' }}\n                >\n                  <svg\n                    className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M6 18L18 6M6 6l12 12\"\n                    />\n                  </svg>\n              </button>\n              </div>\n            </div>\n          )}\n\n          {/* Bottom-center: Control Bar (Mic + End Call only) */}\n          <div className=\"absolute bottom-1.5 sm:bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-800/90 backdrop-blur-sm rounded-full px-1.5 py-1 sm:px-3 sm:py-1.5 flex items-center gap-1.5 sm:gap-2 z-20\">\n            {/* Microphone Button */}\n            {isAvatarReady && <MicrophoneButtonControl />}\n\n            {/* End Call Button */}\n              <button\n                onClick={handleEndSession}\n              className=\"w-12 h-12 sm:w-12 sm:h-12 rounded-full bg-red-600 hover:bg-red-700 active:bg-red-800 active:scale-95 flex items-center justify-center transition-all duration-200 touch-manipulation shadow-lg min-w-[48px] min-h-[48px]\"\n              title=\"End Session\"\n              style={{ WebkitTapHighlightColor: 'transparent' }}\n            >\n              <svg\n                className=\"w-5 h-5 sm:w-5 sm:h-5\"\n                viewBox=\"0 0 24 24\"\n                fill=\"none\"\n                stroke=\"white\"\n                strokeWidth=\"2\"\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n              >\n                <path d=\"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z\" />\n              </svg>\n              </button>\n            </div>\n\n          {/* Chat/Transcription Toggle Button - Bottom Right */}\n          {isAvatarReady && !showTranscription && (\n            <button\n              onClick={() => setShowTranscription(true)}\n              className=\"absolute bottom-1.5 right-1.5 sm:bottom-4 sm:right-4 w-12 h-12 sm:w-12 sm:h-12 rounded-lg bg-gray-800 hover:bg-gray-700 active:bg-gray-600 active:scale-95 flex items-center justify-center transition-all duration-200 z-20 shadow-lg touch-manipulation min-w-[48px] min-h-[48px]\"\n              title=\"Open Chat\"\n              style={{ WebkitTapHighlightColor: 'transparent' }}\n            >\n              <svg\n                className=\"w-5 h-5 sm:w-6 sm:h-6\"\n                viewBox=\"0 0 24 24\"\n                fill=\"none\"\n                stroke=\"white\"\n                strokeWidth=\"2\"\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n              >\n                <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\" />\n              </svg>\n            </button>\n          )}\n          </div>\n        </div>\n\n        {/* Chat Panel - Full width on mobile, side panel on desktop */}\n        {isAvatarReady && showTranscription && (\n          <div className=\"absolute sm:relative inset-0 sm:inset-auto w-full sm:w-96 bg-white border-t sm:border-l border-gray-200 flex flex-col shadow-lg sm:shadow-sm flex-shrink-0 overflow-hidden z-30 sm:z-auto\" style={{ height: '100%', maxHeight: 'calc(100vh - 0.5rem)' }}>\n            {/* Chat Header */}\n            <div className=\"flex items-center justify-between p-3 sm:p-4 border-b border-gray-200 bg-white flex-shrink-0 z-10\">\n              <h3 className=\"text-sm sm:text-base font-semibold text-gray-900\">Chat & Messages</h3>\n              <button\n                onClick={() => setShowTranscription(false)}\n                className=\"text-gray-400 hover:text-gray-600 active:text-gray-800 active:opacity-70 transition-all duration-200 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center touch-manipulation rounded-lg\"\n                title=\"Close Chat\"\n                style={{ WebkitTapHighlightColor: 'transparent' }}\n              >\n                <svg\n                  className=\"w-5 h-5\"\n                  viewBox=\"0 0 24 24\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  strokeWidth=\"2\"\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                >\n                  <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\" />\n                  <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\" />\n                </svg>\n              </button>\n            </div>\n\n            {/* Messages Area - Scrollable */}\n            <div \n              ref={messagesContainerRef}\n              className=\"flex-1 overflow-y-auto overflow-x-hidden bg-white\" \n              style={{ minHeight: 0 }}\n            >\n              <MessageHistory\n                sessionTime={sessionTime}\n                messageTimes={messageTimes}\n              />\n            </div>\n\n            {/* Chat Input - Fixed at bottom */}\n            <div className=\"border-t border-gray-200 bg-white p-3 sm:p-4 flex-shrink-0 z-10\">\n              <ChatInput />\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default function LivePage() {\n  return (\n    <Suspense\n      fallback={\n        <div className=\"min-h-screen flex items-center justify-center\">\n          Loading...\n        </div>\n      }\n    >\n      <StreamingAvatarProvider basePath={HEYGEN_BASE_PATH}>\n        <LiveSessionContent />\n      </StreamingAvatarProvider>\n    </Suspense>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}